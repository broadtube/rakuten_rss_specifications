# RssMarginPower 非公式テスト確認仕様

## 概要
**関数名**: RssMarginPower  
**カテゴリ**: 口座・資産情報 (Account & Asset Information)  
**用途**: 余力情報（信用）の取得  

**説明**: 指定した国内株式の信用新規建余力を表示します。特定の銘柄を信用取引で新規建する際の余力を確認できます。

## 構文 (Syntax)

### Excel ワークシート関数
```excel
RssMarginPower(ヘッダー行, 銘柄コード)
```

### VBA関数
```vb
RssMarginPower_V(ヘッダー行, 銘柄コード)
```

## パラメータ詳細

| No | パラメータ名 | 必要性 | データ型 | 説明 |
|----|------------|--------|----------|------|
| 1 | ヘッダー行 | △ | セル参照 | 取得項目が入力されているセル範囲を指定します<br>省略時はすべての取得項目を表示します |
| 2 | 銘柄コード | ● | string | 数字4桁（or 5桁）<br>市場コードの指定は不要です |

**凡例**: ● 必須, △ 省略可, ▲ 条件次第で省略可, - 指定不要

## 使用例

### 基本的な信用新規建余力取得
```excel
=RssMarginPower(,"4755")
```
銘柄コード4755の信用新規建余力を取得（ヘッダー行省略）

### ヘッダー行指定での取得
```excel
=RssMarginPower(A1,"4755")
```
A1セルにヘッダー項目を設定して、銘柄コード4755の信用新規建余力を取得

### 複数銘柄の信用新規建余力確認
```excel
// B列に銘柄コード、C列に信用新規建余力を表示
C1: =RssMarginPower(,B1)
C2: =RssMarginPower(,B2)
C3: =RssMarginPower(,B3)
```

## 戻り値

### 成功時の出力形式

**データ構造**: 一覧形式
- **ヘッダー行**: 項目名（省略時は自動生成）
- **データ行**: 各項目の値

### 出力項目

| No | 項目名 | データ型 | 説明 |
|----|--------|----------|------|
| 1 | 信用新規建余力 | number | 指定銘柄の信用新規建余力を表示（円） |
| 2 | 保証金率(新規建) | number | 保証金率(新規建)を表示（%） |
| 3 | 保証金率(リアル) | number | 保証金率(リアル)を表示（%） |
| 4 | 保証金率 | number | 保証金率を表示（%） |

### 実際の出力例

#### ヘッダー行省略の場合
```excel
=RssMarginPower(,"4755")
```
結果：
```
信用新規建余力    保証金率(新規建)    保証金率(リアル)    保証金率
5412123          250.5              245.3              248.0
```

#### ヘッダー行指定の場合
```excel
// A1:D1にヘッダー項目を入力
A1: 新規建余力
B1: 新規建率
C1: リアル率
D1: 保証金率
=RssMarginPower(A1:D1,"7203")
```
結果：
```
新規建余力    新規建率    リアル率    保証金率
5412123      250.5      245.3      248.0
```

### 失敗時の出力

**可能なエラー**:
- `銘柄コードは、4桁または5桁で入力してください。` - 銘柄コード形式エラー
- `ヘッダー行は、単一行のセル範囲で入力してください。` - ヘッダー行形式エラー
- `ヘッダー行に有効な項目名が存在しません。` - 存在しない銘柄等
- `#VALUE!` - パラメータ形式エラー
- `#N/A` - ログインエラー、サービス利用不可

## エラーコード
| エラー | 原因 | 対処法 |
|--------|------|--------|
| 銘柄コードは、4桁または5桁で入力してください | 銘柄コード形式エラー | 4桁または5桁の数字文字列を指定 |
| ヘッダー行は、単一行のセル範囲で入力してください | ヘッダー行形式エラー | 単一行のセル範囲を指定 |
| ヘッダー行に有効な項目名が存在しません | 銘柄が存在しない等 | 有効な銘柄コードを指定 |
| #VALUE! | パラメータ形式エラー | パラメータの型と値を確認 |
| #N/A | ログインエラー | ログイン状況を確認 |

## 活用例

### 信用取引前の余力確認
```excel
// A列: 銘柄コード
// B列: 現在株価
// C列: 購入希望数
// D列: 必要保証金
// E列: 信用新規建余力

E2: =INDEX(RssMarginPower(,A2),2,1)
D2: =B2*C2*0.3  // 保証金率30%として計算
F2: =IF(E2>=D2, "建玉可能", "余力不足")
```

### 複数銘柄の保証金率確認
```excel
// 保証金率のみ取得
=INDEX(RssMarginPower(,A2),2,4)  // 保証金率を取得
```

### VBAでの活用
```vb
Sub CheckMarginPower()
    Dim stockCode As String
    Dim marginPower As Variant
    
    stockCode = "4755"
    ' ヘッダー行を省略して信用新規建余力を取得
    marginPower = Application.WorksheetFunction.RssMarginPower_V(, stockCode)
    
    ' 配列の最初の要素が信用新規建余力
    MsgBox "銘柄 " & stockCode & " の信用新規建余力: " & Format(marginPower(2, 1), "#,##0") & "円"
End Sub
```

## 関連関数
- **RssBuyingPower**: 余力情報（現物）
- **RssMarginPositionList**: 信用建玉一覧
- **RssCapacityList**: 余力・保証金率
- **RssMarginOpenOrder**: 信用新規注文
- **RssMarket**: 市況情報（現物株価取得）

## 注意事項

1. **銘柄コード必須**: 銘柄コードは必須パラメータです
2. **市場コード不要**: 銘柄コードに市場コード（.T等）は不要です
3. **自動更新なし**: この関数は自動更新対象外です（-）
4. **ログイン必要**: 楽天証券へのログインが必要です
5. **信用口座必要**: 信用取引口座の開設が必要です
6. **リアルタイム性**: 信用新規建余力はリアルタイムで変動します
7. **銘柄別制限**: 制度信用・一般信用の区別、銘柄別の建玉制限があります

## 保証金率の説明

### 各保証金率の違い
- **保証金率(新規建)**: 新規建玉時の保証金率
- **保証金率(リアル)**: リアルタイムの保証金率
- **保証金率**: 基準となる保証金率

### 最低保証金維持率
- 維持率が一定水準を下回ると追証が発生
- 銘柄により必要保証金率が異なる場合あり

## 銘柄別の必要性

この関数が銘柄コードを必要とする理由：
- 銘柄により保証金率が異なる
- 制度信用・一般信用の区別
- 銘柄別の建玉上限の確認
- 規制銘柄の判定

## バージョン情報
- RSS Version: 2.0
- 対応: Excel 2016以降
- 最終更新: 2024年

## 参考資料
- MARKETSPEED II RSS オンラインヘルプ
- 楽天証券 RSS関数マニュアル PDF