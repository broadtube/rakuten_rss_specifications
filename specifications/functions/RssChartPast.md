# RssChartPast 非公式テスト確認仕様

## 概要
**関数名**: RssChartPast  
**カテゴリ**: チャート・テクニカル分析 (Chart & Technical Analysis)  
**用途**: 過去チャート情報（4本値）の取得  

**説明**: 国内株式や先物OP銘柄の指定開始日からのチャート情報（始値、高値、安値、終値の4本値）をExcelに表示します。特定の期間を指定してチャートデータを取得できます。

## 構文 (Syntax)

### Excel ワークシート関数
```excel
RssChartPast(引数列, ヘッダ行, 銘柄コード, 足種, 開始日, 表示本数)
```

### VBA関数
```vb
RssChartPast_V(引数列, ヘッダ行, 銘柄コード, 足種, 開始日, 表示本数)
```

## パラメータ詳細

| No | パラメータ名 | 必要性 | データ型 | 説明 |
|----|------------|--------|----------|------|
| 1 | 引数列 | ● | number | データ列の開始位置を指定する数値 |
| 2 | ヘッダ行 | ● | number | ヘッダ行の位置を指定する数値 |
| 3 | 銘柄コード | ● | string | 4-5桁英数字の銘柄コード<br>「.市場」は省略可（.T:東証, .JAX:JASDAQ, .JNX:JNX） |
| 4 | 足種 | ● | string | チャートの時間軸を指定<br>「D」:日足, 「W」:週足, 「M」:月足, 「1」:1分足, 「3」:3分足, 「5」:5分足, 「10」:10分足, 「15」:15分足, 「30」:30分足, 「60」:60分足 |
| 5 | 開始日 | ● | string | 取得開始日をYYYYMMDD形式で指定 |
| 6 | 表示本数 | ● | number | 取得するデータの本数（最大200本） |

**凡例**: ● 必須, △ 省略可, ▲ 条件次第で省略可, - 指定不要

## 使用例

### 特定日からの日足チャート取得
```excel
=RssChartPast(A1, 1, "4755", "D", "20240401", 30)
```
楽天グループ（4755）の2024年4月1日から30本の日足チャート取得

### 週足チャートの期間指定取得
```excel
=RssChartPast(C1, 1, "7203", "W", "20240101", 20)
```
トヨタ自動車（7203）の2024年1月1日から20本の週足チャート取得

### 月足チャートの長期取得
```excel
=RssChartPast(A5, 2, "9984", "M", "20230101", 12)
```
ソフトバンクグループ（9984）の2023年1月から12ヶ月分の月足チャート取得

### 先物の過去データ取得
```excel
=RssChartPast(A1, 1, "NK225M", "D", "20240301", 50)
```
日経225先物の2024年3月1日から50本の日足チャート取得

## 戻り値

### 成功時の出力形式

**データ構造**: マトリクス形式（配列）
- **ヘッダ行**: 項目名（日付、始値、高値、安値、終値、出来高）
- **データ行**: 各足の4本値データ（指定開始日から順次表示）

### 実際の出力例

#### 過去日足チャートの出力
```excel
=RssChartPast(A1, 1, "4755", "D", "20240401", 5)
```

| 日付 | 始値 | 高値 | 安値 | 終値 | 出来高 |
|------|------|------|------|------|--------|
| 20240401 | 1050 | 1070 | 1045 | 1065 | 4123000 |
| 20240402 | 1065 | 1080 | 1060 | 1075 | 3456000 |
| 20240403 | 1075 | 1090 | 1070 | 1085 | 3789000 |
| 20240404 | 1085 | 1100 | 1080 | 1095 | 4234000 |
| 20240405 | 1095 | 1110 | 1090 | 1105 | 3567000 |

#### 週足チャートの出力
```excel
=RssChartPast(A10, 1, "7203", "W", "20240101", 3)
```

| 日付 | 始値 | 高値 | 安値 | 終値 | 出来高 |
|------|------|------|------|------|--------|
| 20240108 | 2450 | 2520 | 2440 | 2510 | 15234000 |
| 20240115 | 2510 | 2550 | 2480 | 2530 | 13456000 |
| 20240122 | 2530 | 2570 | 2520 | 2560 | 14789000 |

### データ項目の詳細

| 項目 | データ型 | 説明 |
|------|----------|------|
| 日付 | string | YYYYMMDD形式、その期間の開始日 |
| 始値 | number | その期間の開始価格 |
| 高値 | number | その期間の最高価格 |
| 安値 | number | その期間の最低価格 |
| 終値 | number | その期間の終了価格 |
| 出来高 | number | その期間の売買高累計 |

### 失敗時の出力

**データ構造**: 単一セル
- **関数セル**: エラーコード（Excel標準エラー）

**可能なエラーコード**:
- `#VALUE!` - パラメータ形式エラー、日付形式不正
- `#N/A` - 銘柄コード無効、指定期間にデータなし
- `#NUM!` - 数値パラメータの範囲外
- `#REF!` - セル参照エラー

### 特別なケース

#### 無効な開始日指定
```excel
=RssChartPast(A1, 1, "4755", "D", "20001231", 10)  // 古すぎる日付
```
結果：`#N/A` またはデータ開始日からのデータを返却

#### 未来日付の指定
```excel
=RssChartPast(A1, 1, "4755", "D", "20251231", 10)  // 未来日付
```
結果：`#VALUE!`

#### 休場日からの開始指定
```excel
=RssChartPast(A1, 1, "4755", "D", "20240504", 5)  // GW期間開始
```
結果：次の営業日からのデータを返却

#### 指定期間にデータが不足
```excel
=RssChartPast(A1, 1, "4755", "D", "20240501", 100)  // 過大な本数
```
結果：利用可能な最大本数までのデータを返却

## エラーコード
| エラー | 原因 | 対処法 |
|--------|------|--------|
| #VALUE! | 日付形式不正、未来日付指定 | YYYYMMDD形式での過去日付を指定 |
| #N/A | 銘柄コード無効、期間にデータなし | 銘柄コード、データ保存期間を確認 |
| #NUM! | 表示本数の範囲外 | 表示本数を1-200の範囲で指定 |
| #REF! | セル参照エラー | セル参照の指定を確認 |

## 関連関数
- **RssChart**: 最新からのチャート情報
- **RssTrendSMA**: 移動平均線データ
- **RssMarket**: リアルタイム市況データ
- **RssTickList**: ティック（歩み値）データ

## 注意事項

1. **データ保存期間**: 足種により利用可能期間が異なります
2. **開始日調整**: 休場日を指定した場合は翌営業日から開始されます
3. **最大取得本数**: 200本を超える指定はできません
4. **分足制限**: 分足データは当日および前営業日のみ利用可能
5. **データ確定**: 日足以上は翌営業日に確定データが反映されます

## データ保存期間

### 日足系
| 足種 | 保存期間 | 最古データ目安 |
|------|----------|---------------|
| D | 約3年 | 2021年頃から |
| W | 約5年 | 2019年頃から |
| M | 約10年 | 2014年頃から |

### 分足系（過去データ制限）
| 足種 | 保存期間 | 注意事項 |
|------|----------|----------|
| 1-60分足 | 当日+前営業日のみ | 過去日付指定は無効 |

## 開始日の指定ルール

1. **営業日調整**: 休場日指定時は翌営業日から開始
2. **データ範囲**: 保存期間外の古い日付は最古データから開始
3. **未来日付**: エラーまたは最新データまでを返却
4. **形式**: YYYYMMDD形式（8桁数字）で指定

## バージョン情報
- RSS Version: 2.0
- 対応: Excel 2016以降
- 最終更新: 2024年

## 参考資料
- MARKETSPEED II RSS オンラインヘルプ
- 楽天証券 RSS関数マニュアル PDF