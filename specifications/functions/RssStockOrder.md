# RssStockOrder 非公式テスト確認仕様

## 概要
**関数名**: RssStockOrder  
**カテゴリ**: 注文管理 (Order Management)  
**用途**: 現物株式注文の発注  

**説明**: 現物株式の売買注文を行います。通常注文、逆指値注文、セット注文（OCO）に対応し、成行・指値・条件付注文が可能です。

## 構文 (Syntax)

### Excel ワークシート関数
```excel
RssStockOrder(発注ID, 発注トリガー, 銘柄コード, 売買区分, 注文区分, SOR区分, 注文数量, 価格区分, 注文価格, 執行条件, 注文期限, 口座区分, 逆指値条件価格, 逆指値条件区分, 逆指値価格区分, 逆指値価格, セット注文区分, セット注文価格, セット注文執行条件, セット注文期限)
```

### VBA関数
```vb
RssStockOrder_V(発注ID, 銘柄コード, 売買区分, 注文区分, SOR区分, 注文数量, 価格区分, 注文価格, 執行条件, 注文期限, 口座区分, 逆指値条件価格, 逆指値条件区分, 逆指値価格区分, 逆指値価格, セット注文区分, セット注文価格, セット注文執行条件, セット注文期限)
```

## パラメータ詳細

| No | パラメータ名 | 通常注文 | 逆指値付通常注文 | 逆指値注文 | データ型 | 説明 |
|----|------------|---------|------------------|-----------|----------|------|
| 1 | 発注ID | ● | ● | ● | number | Excelから注文を一意に識別するための番号<br>(1以上2147483647以下の数値で入力) |
| 2 | 発注トリガー | ● | ● | ● | number | 0(False):待機, 1(True):発注 |
| 3 | 銘柄コード | ● | ● | ● | string | 4-5桁英数字の銘柄コード<br>「.市場」は省略可（.T:東証, .JAX:JAX, .JNX:JNX） |
| 4 | 売買区分 | ● | ● | ● | string | 1:売り, 3:買い |
| 5 | 注文区分 | ● | ● | ● | string | 0:通常注文, 1:逆指値付注文, 2:逆指値待機注文 |
| 6 | SOR区分 | ● | ● | ● | string | 0:通常注文, 1:SOR注文 |
| 7 | 注文数量 | ● | ● | ● | number | 注文する株数 |
| 8 | 価格区分 | ● | ● | - | string | 0:成行, 1:指値（逆指値注文時は不要） |
| 9 | 注文価格 | △ | △ | - | number | 指値の場合の価格 |
| 10 | 執行条件 | ● | ● | ● | string | 1:本日中, 2:今週中, 3:寄付, 4:引け, 5:期間指定, 6:大引不成, 7:不成 |
| 11 | 注文期限 | △ | △ | △ | string | 期間指定時のYYYYMMDD形式日付 |
| 12 | 口座区分 | ● | ● | ● | string | 0:特定, 1:一般, 2:NISA, 3:旧NISA |
| 13 | 逆指値条件価格 | - | ● | ● | number | 逆指値の条件価格 |
| 14 | 逆指値条件区分 | - | ● | ● | string | 1:以上, 2:以下 |
| 15 | 逆指値価格区分 | - | ● | ● | string | 0:成行, 1:指値 |
| 16 | 逆指値価格 | - | ● | ● | number | 逆指値の価格 |
| 17 | セット注文区分 | △ | △ | △ | string | 0:通常（予約しない）, 1:セット注文（予約する） |
| 18 | セット注文価格 | △ | △ | △ | number | セット注文の価格 |
| 19 | セット注文執行条件 | △ | △ | △ | string | 1:本日中, 2:今週中, 3:寄付, 4:引け, 5:期間指定, 6:大引不成, 7:不成 |
| 20 | セット注文期限 | △ | △ | △ | string | セット注文の期日（YYYYMMDD形式） |

**凡例**: ● 必須, △ 省略可, ▲ 条件次第で省略可, - 指定不要

## 使用例

### 基本的な買い注文（成行）
```excel
=RssStockOrder(1,1,4755,3,0,0,100,0,,1,,0)
```
楽天グループ（4755）を100株、成行で買い注文

### 指値買い注文
```excel
=RssStockOrder(2,1,7203,3,0,0,100,1,2500,1,,0)
```
トヨタ自動車（7203）を100株、2,500円指値で買い注文

### セット注文（OCO）
```excel
=RssStockOrder(3,1,4755,3,0,0,100,1,1100,1,,0,,,,,1,1110,1,)
```
楽天グループを1,100円で買い、1,110円でセット売り注文

### 逆指値付通常注文
```excel
=RssStockOrder(4,1,"4755.T",3,1,0,100,1,1100,1,,1,1110,1,1,1110)
```
楽天グループが1,110円以上になったら1,110円で買い注文

## 戻り値

### 成功時の出力形式

**データ構造**: 単一セル
- **関数セル**: 発注受付番号（文字列）

### 実際の出力例

#### 成功時の発注受付番号
```excel
=RssStockOrder(1,1,4755,3,0,0,100,0,,1,,0)
```
結果：`S2024050800001` （文字列、受付番号）

#### NISA口座での注文
```excel
=RssStockOrder(2,1,4755,3,0,0,100,1,1150,1,,2)
```
結果：`S2024050800002` （文字列、受付番号）

### 発注受付番号の形式

| 項目 | 形式 | 例 | 説明 |
|------|------|-----|------|
| 受付番号 | string | `S` + `YYYYMMDD` + 5桁連番 | `S2024050800001` |
| プレフィックス | string | `S` | 現物取引識別コード |
| 日付部分 | string | `YYYYMMDD` | 発注日（年月日） |
| 連番部分 | string | 5桁数字 | 日内連続番号 |

### 失敗時の出力

**データ構造**: 単一セル
- **関数セル**: エラーコード（Excel標準エラー）

**可能なエラーコード**:
- `#VALUE!` - パラメータ形式エラー
- `#N/A` - 銘柄コード無効、市場休場、余力不足等
- `#NUM!` - 数値パラメータの範囲外
- `#REF!` - セル参照エラー

### 特別なケース

#### 市場休場時
```excel
=RssStockOrder(1,1,4755,3,0,0,100,0,,1,,0)
```
結果：`#N/A`

#### 余力不足
```excel
=RssStockOrder(1,1,4755,3,0,0,100,1,1000000,1,,0)  // 高額指値
```
結果：`#N/A` またはエラーメッセージを含む文字列

#### 制限値幅外価格
```excel
=RssStockOrder(1,1,4755,3,0,0,100,1,9999,1,,0)  // 制限値幅外
```
結果：`#N/A`

#### 単元未満株数
```excel
=RssStockOrder(1,1,4755,3,0,0,50,1,1150,1,,0)  // 100株未満
```
結果：`#NUM!`

## エラーコード
| エラー | 原因 | 対処法 |
|--------|------|--------|
| #VALUE! | パラメータ形式エラー、発注ID重複 | パラメータの型と値、発注IDを確認 |
| #N/A | 銘柄コード無効、市場休場、余力不足等 | 銘柄コード、市場時間、口座余力を確認 |
| #NUM! | 数値パラメータの範囲外 | 注文数量、価格の妥当性を確認 |
| #REF! | セル参照エラー | セル参照の指定を確認 |

## 関連関数
- **RssMarginOpenOrder**: 信用新規注文
- **RssModifyOrder**: 注文訂正
- **RssCancelOrder**: 注文取消
- **RssOrderList**: 注文一覧
- **RssOrderStatus**: 注文状況確認

## 注意事項

1. **売買単位**: 100株単位での注文が基本です
2. **制限値幅**: 制限値幅内の価格で注文してください
3. **市場時間**: 各市場の開場時間内で注文可能です
4. **口座区分**: NISA口座では売りは制限があります
5. **SOR注文**: 寄付・引け指定は不可です

## 口座区分の詳細

| 区分 | 口座種類 | 特徴 |
|------|----------|------|
| 0 | 特定 | 源泉徴収ありの特定口座 |
| 1 | 一般 | 一般口座（確定申告必要） |
| 2 | NISA | 新NISA口座 |
| 3 | 旧NISA | 旧NISA口座 |

## バージョン情報
- RSS Version: 2.0
- 対応: Excel 2016以降
- 最終更新: 2024年

## 参考資料
- MARKETSPEED II RSS オンラインヘルプ
- 楽天証券 RSS関数マニュアル PDF