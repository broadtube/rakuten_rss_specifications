# RssExecutionList 完全仕様書

## 概要
**関数名**: RssExecutionList  
**カテゴリ**: 約定管理 (Execution Management)  
**用途**: 国内株式約定一覧の取得  

**説明**: 国内株式の約定一覧を取得してExcelに表示します。約定済みの取引の詳細情報（約定価格、約定数量、約定日時等）を確認でき、取引履歴の管理や損益計算に活用できます。

## 構文 (Syntax)

### Excel ワークシート関数
```excel
RssExecutionList(引数列, ヘッダ行)
```

### VBA関数
```vb
RssExecutionList_V(引数列, ヘッダ行)
```

## パラメータ詳細

| No | パラメータ名 | 必要性 | データ型 | 説明 |
|----|------------|--------|----------|------|
| 1 | 引数列 | ● | number | データ列の開始位置を指定する数値 |
| 2 | ヘッダ行 | ● | number | ヘッダ行の位置を指定する数値 |

**凡例**: ● 必須, △ 省略可, ▲ 条件次第で省略可, - 指定不要

## 使用例

### 基本的な約定一覧取得
```excel
=RssExecutionList(A1, 1)
```
国内株式約定一覧をA1から表示、1行目にヘッダを配置

### 他の位置での約定一覧表示
```excel
=RssExecutionList(D3, 4)
```
国内株式約定一覧をD3から表示、4行目にヘッダを配置

## 戻り値

### 成功時の出力形式

**データ構造**: マトリクス形式（配列）
- **ヘッダ行**: 項目名
- **データ行**: 各約定の詳細情報

### 実際の出力例

#### 約定一覧の出力
```excel
=RssExecutionList(A1, 1)
```

| 約定番号 | 注文番号 | 銘柄コード | 銘柄名 | 売買区分 | 約定数量 | 約定価格 | 約定金額 | 約定日時 | 受渡日 | 手数料 | 口座区分 | 決済区分 |
|----------|----------|-----------|--------|----------|----------|----------|----------|----------|--------|--------|----------|----------|
| E2024050800001 | S2024050800001 | 4755 | 楽天グループ | 買 | 100 | 1140 | 114000 | 20240508 09:01:15 | 20240510 | 99 | 特定 | 現物 |
| E2024050800002 | S2024050700003 | 9984 | SBG | 買 | 100 | 9850 | 985000 | 20240508 09:15:32 | 20240510 | 487 | 特定 | 現物 |
| E2024050700003 | S2024050700002 | 7203 | トヨタ自動車 | 売 | 100 | 2500 | 250000 | 20240507 14:30:45 | 20240509 | 487 | 特定 | 現物 |

### データ項目の詳細

| 項目 | データ型 | 説明 |
|------|----------|------|
| 約定番号 | string | 約定を一意に識別する番号（例：E2024050800001） |
| 注文番号 | string | 元となる注文の番号（例：S2024050800001） |
| 銘柄コード | string | 4-5桁の銘柄コード |
| 銘柄名 | string | 銘柄の正式名称 |
| 売買区分 | string | 買/売 |
| 約定数量 | number | 約定した株数 |
| 約定価格 | number | 1株あたりの約定価格 |
| 約定金額 | number | 約定価格×約定数量（手数料・税金除く） |
| 約定日時 | string | 約定した日時（YYYY/MM/DD HH:MM:SS） |
| 受渡日 | string | 決済予定日（YYYY/MM/DD） |
| 手数料 | number | 取引手数料（税込） |
| 口座区分 | string | 特定/一般/NISA/旧NISA |
| 決済区分 | string | 現物/信用新規/信用返済 |

### 約定番号の形式

| 項目 | 形式 | 例 | 説明 |
|------|------|-----|------|
| 約定番号 | string | `E` + `YYYYMMDD` + 5桁連番 | `E2024050800001` |
| プレフィックス | string | `E` | 約定取引識別コード |
| 日付部分 | string | `YYYYMMDD` | 約定日（年月日） |
| 連番部分 | string | 5桁数字 | 日内連続番号 |

### 失敗時の出力

**データ構造**: 単一セル
- **関数セル**: エラーコード（Excel標準エラー）

**可能なエラーコード**:
- `#VALUE!` - パラメータ形式エラー
- `#N/A` - ログインエラー、サービス利用不可
- `#REF!` - セル参照エラー

### 特別なケース

#### 約定がない場合
```excel
=RssExecutionList(A1, 1)
```
結果：ヘッダ行のみ表示、データ行なし

#### 部分約定の複数記録
```excel
=RssExecutionList(A1, 1)
```
結果：同一注文番号で複数の約定レコードが表示される場合あり

| 約定番号 | 注文番号 | 銘柄コード | 約定数量 | 約定価格 | 約定時刻 |
|----------|----------|-----------|----------|----------|----------|
| E2024050800001 | S2024050800001 | 4755 | 60 | 1140 | 09:01:15 |
| E2024050800002 | S2024050800001 | 4755 | 40 | 1141 | 09:02:30 |

## エラーコード
| エラー | 原因 | 対処法 |
|--------|------|--------|
| #VALUE! | パラメータ形式エラー | パラメータの型と値を確認 |
| #N/A | ログインエラー、サービス利用不可 | ログイン状況、サービス状況を確認 |
| #REF! | セル参照エラー | セル参照の指定を確認 |

## 関連関数
- **RssOrderList**: 注文一覧取得
- **RssPositionList**: 保有証券一覧
- **RssOrderStatus**: 特定注文の状況確認
- **RssBuyingPower**: 余力情報（現物）
- **RssMarginPower**: 余力情報（信用）

## 注意事項

1. **約定確定**: 約定データは即座に反映されますが、受渡処理は受渡日に実行されます
2. **ログイン必要**: 楽天証券へのログインが必要です
3. **データ保持期間**: 約定履歴の表示期間に制限がある場合があります
4. **手数料表示**: 表示される手数料は税込み金額です
5. **セキュリティ**: 口座情報を含むため取り扱いに注意してください

## データ活用例

### 損益計算
```excel
// 買約定金額の合計
=SUMIFS(約定金額列, 売買区分列, "買")

// 売約定金額の合計  
=SUMIFS(約定金額列, 売買区分列, "売")

// 手数料合計
=SUM(手数料列)
```

### 銘柄別集計
```excel
// 特定銘柄の約定数量合計
=SUMIFS(約定数量列, 銘柄コード列, "4755", 売買区分列, "買")

// 特定銘柄の平均約定価格
=SUMPRODUCT(約定価格列*約定数量列, (銘柄コード列="4755")*(売買区分列="買")) / SUMIFS(約定数量列, 銘柄コード列, "4755", 売買区分列, "買")
```

### 期間別分析
```excel
// 本日約定の合計金額
=SUMIFS(約定金額列, 約定日時列, ">="&TODAY())

// 月間約定件数
=COUNTIFS(約定日時列, ">="&DATE(YEAR(TODAY()),MONTH(TODAY()),1))
```

## 決済区分の詳細

### 現物取引
- **現物買**: 現金での株式購入
- **現物売**: 保有株式の売却

### 信用取引
- **信用新規**: 信用建玉の新規作成
- **信用返済**: 信用建玉の決済

## 口座区分による税制上の扱い

| 口座区分 | 税務処理 | 特徴 |
|----------|----------|------|
| 特定 | 源泉徴収あり | 自動的に税務処理完了 |
| 一般 | 確定申告必要 | 年間損益計算が必要 |
| NISA | 非課税 | 売却益・配当金が非課税 |
| 旧NISA | 非課税 | 旧制度での非課税枠 |

## バージョン情報
- RSS Version: 2.0
- 対応: Excel 2016以降
- 最終更新: 2024年

## 参考資料
- MARKETSPEED II RSS オンラインヘルプ
- 楽天証券 RSS関数マニュアル PDF