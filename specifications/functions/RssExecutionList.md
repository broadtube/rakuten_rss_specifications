# RssExecutionList 非公式テスト確認仕様

## 概要
**関数名**: RssExecutionList  
**カテゴリ**: 約定管理 (Execution Management)  
**用途**: 国内株式約定一覧の取得  

**説明**: 国内株式の約定一覧を表示します。全チャンネルからの約定を表示します。約定済みの取引の詳細情報（約定価格、約定数量、約定日時等）を確認でき、取引履歴の管理や損益計算に活用できます。

## 構文 (Syntax)

### Excel ワークシート関数
```excel
RssExecutionList(ヘッダー行, 注文日数, 注文状況, 銘柄コード, 売買, 口座区分)
```

### VBA関数
```vb
RssExecutionList_V(ヘッダー行, 注文日数, 注文状況, 銘柄コード, 売買, 口座区分)
```

## パラメータ詳細

| No | パラメータ名 | 必要性 | データ型 | 説明 |
|----|------------|--------|----------|------|
| 1 | ヘッダー行 | △ | セル参照 | 取得項目が入力されているセル範囲を指定します<br>省略時はすべての取得項目を表示します |
| 2 | 注文日数 | △ | number | 0:本日分、1～3:n日前まで<br>省略された場合は「0」として扱います |
| 3 | 注文状況 | △ | number | 0:全て、1:約定、2:一部出来<br>省略された場合は「0」として扱います |
| 4 | 銘柄コード | △ | string | 数字4桁（or 5桁）<br>市場コードの指定は不要です<br>省略された場合は、全てとして扱います |
| 5 | 売買 | △ | number | 0:全て、1:売、3:買<br>省略された場合は「0」として扱います |
| 6 | 口座区分 | △ | string | A:全て、0:特定、1:一般、2:NISA、3:旧NISA<br>省略された場合は「A」として扱います |

**凡例**: ● 必須, △ 省略可, ▲ 条件次第で省略可, - 指定不要

## 使用例

### 基本的な約定一覧取得（全項目）
```excel
=RssExecutionList()
```
すべての約定項目を表示（ヘッダー行は自動生成）

### ヘッダー行指定での約定一覧
```excel
=RssExecutionList(A1:O1)
```
A1:O1の範囲に指定された項目のみを表示

### 本日の約定のみ取得
```excel
=RssExecutionList(A1:O1, 0)
```
本日分の約定データのみを表示

### 特定銘柄の約定履歴
```excel
=RssExecutionList(A1:O1, 3, 0, "4755")
```
銘柄コード4755の過去3日間の約定を表示

### 買い約定のみ取得
```excel
=RssExecutionList(A1:O1, 0, 0, "", 3)
```
本日の買い約定のみを表示

### 特定口座の約定一覧
```excel
=RssExecutionList(A1:O1, 0, 0, "", 0, "0")
```
特定口座の本日約定を表示

## 戻り値

### 成功時の出力形式

**データ構造**: ヘッダー行型（Type 3）配列
- **ヘッダー行**: 指定された項目名（省略時は全15項目）
- **データ行**: 各約定の詳細情報が複数行で表示

### 出力項目（全15項目）

| No | 項目名 | データ型 | 説明 |
|----|--------|----------|------|
| 1 | 注文番号 | string | 元となる注文の番号 |
| 2 | 約定番号 | string | 約定を一意に識別する番号 |
| 3 | 銘柄コード | string | 4-5桁の銘柄コード |
| 4 | 銘柄名称 | string | 銘柄の正式名称 |
| 5 | 売買 | string | 売/買 |
| 6 | 取引 | string | 現物/信用新規/信用返済等 |
| 7 | 約定数量 | number | 約定した株数 |
| 8 | 約定単価 | number | 1株あたりの約定価格 |
| 9 | 税区分 | string | 課税/非課税等 |
| 10 | 口座区分 | string | 特定/一般/NISA/旧NISA |
| 11 | 手数料・税金 | number | 取引手数料（税込） |
| 12 | 手数料・税金（売却時諸経費） | number | 売却時の諸経費 |
| 13 | 約定日時 | string | 約定した日時（YYYY/MM/DD HH:MM:SS） |
| 14 | 受渡金額 | number | 受渡予定金額 |
| 15 | 受渡日 | string | 決済予定日（YYYY/MM/DD） |

### 実際の出力例

#### 全項目表示の場合
```excel
=RssExecutionList()
```

結果（A1から横方向に展開）：
| A列 | B列 | C列 | D列 | E列 | ... | O列 |
|-----|-----|-----|-----|-----|-----|-----|
| 注文番号 | 約定番号 | 銘柄コード | 銘柄名称 | 売買 | ... | 受渡日 |
| S2024050800001 | E2024050800001 | 4755 | 楽天グループ | 買 | ... | 2024/05/10 |
| S2024050700003 | E2024050800002 | 9984 | SBG | 買 | ... | 2024/05/10 |

#### ヘッダー行指定の場合
```excel
// A1:E1にヘッダー項目を設定
A1: 約定番号
B1: 銘柄コード  
C1: 銘柄名称
D1: 約定数量
E1: 約定単価

=RssExecutionList(A1:E1)
```

結果（指定した5項目のみ表示）：
| A列 | B列 | C列 | D列 | E列 |
|-----|-----|-----|-----|-----|
| 約定番号 | 銘柄コード | 銘柄名称 | 約定数量 | 約定単価 |
| E2024050800001 | 4755 | 楽天グループ | 100 | 1140 |
| E2024050800002 | 9984 | SBG | 100 | 9850 |

### 約定番号の形式

| 項目 | 形式 | 例 | 説明 |
|------|------|-----|------|
| 約定番号 | string | `E` + `YYYYMMDD` + 5桁連番 | `E2024050800001` |
| プレフィックス | string | `E` | 約定取引識別コード |
| 日付部分 | string | `YYYYMMDD` | 約定日（年月日） |
| 連番部分 | string | 5桁数字 | 日内連続番号 |

### 失敗時の出力

**データ構造**: 単一セル
- **関数セル**: エラーコード（Excel標準エラー）

**可能なエラーコード**:
- `#VALUE!` - パラメータ形式エラー
- `#N/A` - ログインエラー、サービス利用不可
- `#REF!` - セル参照エラー
- エラーメッセージ - 「銘柄コードは、4桁または5桁で入力してください。」等

### 特別なケース

#### 約定がない場合
```excel
=RssExecutionList()
```
結果：ヘッダー行のみ表示、データ行なし

#### 部分約定の複数記録
```excel
=RssExecutionList(A1:O1, 0, 2)  // 一部出来のみ
```
結果：同一注文番号で複数の約定レコードが表示される

| 約定番号 | 注文番号 | 銘柄コード | 約定数量 | 約定単価 | 約定日時 |
|----------|----------|-----------|----------|----------|----------|
| E2024050800001 | S2024050800001 | 4755 | 60 | 1140 | 2024/05/08 09:01:15 |
| E2024050800002 | S2024050800001 | 4755 | 40 | 1141 | 2024/05/08 09:02:30 |

## エラーコード
| エラー | 原因 | 対処法 |
|--------|------|--------|
| #VALUE! | パラメータ形式エラー | パラメータの型と値を確認 |
| #N/A | ログインエラー、サービス利用不可 | ログイン状況、サービス状況を確認 |
| #REF! | セル参照エラー | セル参照の指定を確認 |
| 銘柄コードは、4桁または5桁で入力してください | 銘柄コード形式エラー | 4桁または5桁の数字、または空文字列を指定 |

## 関連関数
- **RssOrderList**: 注文一覧取得
- **RssPositionList**: 保有証券一覧
- **RssOrderStatus**: 特定注文の状況確認
- **RssBuyingPower**: 余力情報（現物）
- **RssMarginPower**: 余力情報（信用）

## 注意事項

1. **ヘッダー行型関数**: この関数はType 3（ヘッダー行必須型）の関数です
2. **銘柄コード省略**: 全銘柄を取得する場合は空文字列("")または省略
3. **約定確定**: 約定データは即座に反映されますが、受渡処理は受渡日に実行されます
4. **ログイン必要**: 楽天証券へのログインが必要です
5. **データ保持期間**: 約定履歴の表示期間に制限がある場合があります（最大3日前まで）
6. **手数料表示**: 表示される手数料は税込み金額です
7. **セキュリティ**: 口座情報を含むため取り扱いに注意してください

## データ活用例

### 損益計算
```excel
// 買約定金額の合計
=SUMIFS(約定金額列, 売買列, "買")

// 売約定金額の合計  
=SUMIFS(約定金額列, 売買列, "売")

// 手数料合計
=SUM(手数料列)
```

### 銘柄別集計
```excel
// 特定銘柄の約定数量合計
=SUMIFS(約定数量列, 銘柄コード列, "4755", 売買列, "買")

// 特定銘柄の平均約定価格
=SUMPRODUCT(約定単価列*約定数量列, (銘柄コード列="4755")*(売買列="買")) / SUMIFS(約定数量列, 銘柄コード列, "4755", 売買列, "買")
```

### 期間別分析
```excel
// 本日約定の合計金額
=SUMIFS(受渡金額列, 約定日時列, ">="&TODAY())

// 月間約定件数
=COUNTIFS(約定日時列, ">="&DATE(YEAR(TODAY()),MONTH(TODAY()),1))
```

## 取引種別の詳細

### 現物取引
- **現物買**: 現金での株式購入
- **現物売**: 保有株式の売却

### 信用取引
- **信用新規**: 信用建玉の新規作成
- **信用返済**: 信用建玉の決済
- **現引**: 信用買建玉を現物株式として引き取り
- **現渡**: 保有現物株式で信用売建玉を決済

## 口座区分による税制上の扱い

| 口座区分 | 税務処理 | 特徴 |
|----------|----------|------|
| 特定 | 源泉徴収あり | 自動的に税務処理完了 |
| 一般 | 確定申告必要 | 年間損益計算が必要 |
| NISA | 非課税 | 売却益・配当金が非課税 |
| 旧NISA | 非課税 | 旧制度での非課税枠 |

## 注文状況パラメータの詳細

| 値 | 意味 | 説明 |
|----|------|------|
| 0 | 全て | すべての約定を表示 |
| 1 | 約定 | 全部約定した注文の約定のみ |
| 2 | 一部出来 | 部分約定した注文の約定のみ |

## バージョン情報
- RSS Version: 2.0
- 対応: Excel 2016以降
- 最終更新: 2024年

## 参考資料
- MARKETSPEED II RSS オンラインヘルプ
- 楽天証券 RSS関数マニュアル PDF