# RssFOPCapacityList 非公式テスト確認仕様

## 概要
**関数名**: RssFOPCapacityList  
**カテゴリ**: 先物OP資産情報 (Futures & Options Asset Information)  
**用途**: 余力情報（先物OP）の取得  

**説明**: 先物オプションの余力情報を表示します。証拠金維持率や必要証拠金等の先物・オプション取引に必要な資金管理情報を確認できます。

## 構文 (Syntax)

### Excel ワークシート関数
```excel
RssFOPCapacityList(ヘッダー行)
```

### VBA関数
```vb
RssFOPCapacityList_V(ヘッダー行)
```

## パラメータ詳細

| No | パラメータ名 | 必要性 | データ型 | 説明 |
|----|------------|--------|----------|------|
| 1 | ヘッダー行 | △ | セル参照 | 取得項目が入力されているセル範囲を指定します<br>省略時はすべての取得項目を表示します |

**凡例**: ● 必須, △ 省略可, ▲ 条件次第で省略可, - 指定不要

## 使用例

### 基本的な先物OP余力情報取得
```excel
=RssFOPCapacityList()
```
全ての先物OP余力情報を取得（ヘッダー行省略）

### ヘッダー行指定での取得
```excel
=RssFOPCapacityList(A1:F1)
```
A1:F1セルにヘッダー項目を設定して、必要な項目のみを取得

### 特定項目のみ取得
```excel
// A5:C5に必要な項目名を入力
A5: 証拠金維持率
B5: 受入証拠金
C5: 追証余裕額
=RssFOPCapacityList(A5:C5)
```

## 戻り値

### 成功時の出力形式

**データ構造**: 一覧形式
- **ヘッダー行**: 項目名（省略時は自動生成）
- **データ行**: 各項目の値

### 出力項目

| No | 項目名 | データ型 | 説明 |
|----|--------|----------|------|
| 1 | 証拠金維持率 | number | 証拠金維持率を表示（%） |
| 2 | 受入証拠金 | number | 受入証拠金を表示（円） |
| 3 | 最低証拠金所要額 | number | 最低証拠金所要額を表示（円） |
| 4 | 当社証拠金所要額 | number | 当社証拠金所要額を表示（円） |
| 5 | 追証余裕額 | number | 追証余裕額を表示（円） |
| 6 | 純資産 | number | 純資産を表示（円） |

### 実際の出力例

#### ヘッダー行省略の場合
```excel
=RssFOPCapacityList()
```
結果：
```
証拠金維持率    受入証拠金    最低証拠金所要額    当社証拠金所要額    追証余裕額    純資産
125.5          2000000      1200000           1500000           500000       2500000
```

#### 建玉がない場合
```excel
=RssFOPCapacityList()
```
結果：
```
証拠金維持率    受入証拠金    最低証拠金所要額    当社証拠金所要額    追証余裕額    純資産
0              0            0                 0                 0            0
```

#### ヘッダー行指定の場合
```excel
// A1:C1にヘッダー項目を入力
A1: 証拠金維持率
B1: 受入証拠金
C1: 追証余裕額
=RssFOPCapacityList(A1:C1)
```
結果：
```
証拠金維持率    受入証拠金    追証余裕額
125.5          2000000      500000
```

### 失敗時の出力

**可能なエラー**:
- `ヘッダー行に有効な項目名が存在しません。` - ヘッダー行に正しい項目名がない
- `ヘッダー行は、単一行のセル範囲で入力してください。` - ヘッダー行形式エラー
- `#VALUE!` - パラメータ形式エラー
- `#N/A` - ログインエラー、サービス利用不可

## エラーコード
| エラー | 原因 | 対処法 |
|--------|------|--------|
| ヘッダー行に有効な項目名が存在しません | ヘッダー行に正しい項目名がない | 正しい項目名を指定 |
| ヘッダー行は、単一行のセル範囲で入力してください | ヘッダー行形式エラー | 単一行のセル範囲を指定 |
| #VALUE! | パラメータ形式エラー | パラメータの型と値を確認 |
| #N/A | ログインエラー | ログイン状況を確認 |

## 活用例

### 証拠金維持率の監視
```excel
// A1に関数を配置
=RssFOPCapacityList()

// 証拠金維持率が100%を下回ったら警告
=IF(INDEX(RssFOPCapacityList(),2,1)<100, "追証注意！", "正常")
```

### 追証余裕額の確認
```excel
// 追証余裕額のみ取得
A1: 追証余裕額
=RssFOPCapacityList(A1)

// 追証余裕額がマイナスなら赤色表示（条件付き書式）
```

### VBAでの活用
```vb
Sub CheckFOPCapacity()
    Dim capacityData As Variant
    
    ' ヘッダー行を省略して全項目取得
    capacityData = Application.WorksheetFunction.RssFOPCapacityList_V()
    
    ' 証拠金維持率を確認（2行1列目が値）
    Dim maintenanceRate As Double
    maintenanceRate = capacityData(2, 1)
    
    If maintenanceRate < 100 Then
        MsgBox "警告: 証拠金維持率が100%を下回っています: " & maintenanceRate & "%"
    ElseIf maintenanceRate < 120 Then
        MsgBox "注意: 証拠金維持率が120%を下回っています: " & maintenanceRate & "%"
    End If
End Sub
```

## 関連関数
- **RssFOPPositionList**: 先物OP建玉一覧
- **RssFOPOrderList**: 先物OP注文一覧
- **RssFOPExecutionList**: 先物OP約定一覧
- **RssCapacityList**: 余力・保証金率（現物・信用）
- **RssFutInfo**: 先物取引情報

## 注意事項

1. **自動更新なし**: この関数は自動更新対象外です（-）
2. **ログイン必要**: 楽天証券へのログインが必要です
3. **先物OP口座必要**: 先物・オプション取引口座の開設が必要です
4. **リアルタイム性**: 証拠金情報はリアルタイムで変動します
5. **追証の発生**: 証拠金維持率が一定水準を下回ると追証が発生します
6. **項目名の正確性**: ヘッダー行を指定する場合は項目名を正確に入力する必要があります

## 項目の説明

### 証拠金維持率
- 受入証拠金に対する必要証拠金の比率
- 100%を下回ると追証が発生
- パーセント表示（%記号なし）

### 受入証拠金
- 実際に預託している証拠金額
- 現金および代用有価証券の評価額を含む

### 最低証拠金所要額
- 取引所が定める最低限必要な証拠金額
- SPAN証拠金により算出

### 当社証拠金所要額
- 楽天証券が定める必要証拠金額
- 最低証拠金所要額以上の金額

### 追証余裕額
- 追証が発生するまでの余裕額
- マイナスの場合は追証が発生している

### 純資産
- 先物OP取引口座の純資産額
- 証拠金、評価損益、実現損益の合計

## バージョン情報
- RSS Version: 2.0
- 対応: Excel 2016以降
- 最終更新: 2024年

## 参考資料
- MARKETSPEED II RSS オンラインヘルプ
- 楽天証券 RSS関数マニュアル PDF