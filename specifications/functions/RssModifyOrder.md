# RssModifyOrder 非公式テスト確認仕様

## 概要
**関数名**: RssModifyOrder  
**カテゴリ**: 注文管理 (Order Management)  
**用途**: 注文訂正の実行  

**説明**: 既存の注文内容を訂正します。注文番号を指定して、価格・数量・執行条件等の変更が可能です。注文区分の変更は通常注文⇔逆指値付通常注文のみ対応しています。

## 構文 (Syntax)

### Excel ワークシート関数
```excel
RssModifyOrder(発注ID, 発注トリガー, 注文番号, 注文区分, 注文数量, 価格区分, 注文価格, 執行条件, 注文期限, 逆指値条件価格, 逆指値条件区分, 逆指値価格区分, 逆指値価格, セット注文価格区分, セット注文価格, セット注文執行条件, セット注文期限)
```

### VBA関数
```vb
RssModifyOrder_V(発注ID, 注文番号, 注文区分, 注文数量, 価格区分, 注文価格, 執行条件, 注文期限, 逆指値条件価格, 逆指値条件区分, 逆指値価格区分, 逆指値価格, セット注文価格区分, セット注文価格, セット注文執行条件, セット注文期限)
```

## パラメータ詳細

| No | パラメータ名 | データ型 | 必須/任意 | 説明 |
|----|------------|----------|-----------|------|
| 1 | 発注ID | number | ● | Excelから注文を一意に識別するための番号<br>(1以上2147483647以下の数値で入力) |
| 2 | 発注トリガー | number | ● | 0(False):待機, 1(True):発注<br>省略時は0(False):待機<br>（Excel版のみ） |
| 3 | 注文番号 | number | ● | 訂正対象明細の注文番号を入力 |
| 4 | 注文区分 | string | ● | 訂正元の注文区分を入力<br>0:通常注文, 1:逆指値付通常注文, 2:逆指値注文<br>訂正元の注文区分を訂正する場合:<br>3:通常注文⇒逆指値付通常注文, 4:逆指値付通常注文⇒通常注文 |
| 5 | 注文数量 | number | △ | 注文数量の訂正時入力（訂正可否条件あり） |
| 6 | 価格区分 | string | △ | 価格区分訂正時、0:成行, 1:指値を入力<br>（注文区分が「0:通常注文」or「1:逆指値付通常注文」の場合、訂正可能） |
| 7 | 注文価格 | number | △ | 注文価格の訂正時入力<br>（注文区分が「0:通常注文」or「1:逆指値付通常注文」の場合、訂正可能） |
| 8 | 執行条件 | string | △ | 訂正元の執行条件が「2:今週中」「5:期間指定」以外の執行条件は訂正可能<br>1:本日中, 2:今週中, 3:寄付, 4:引け, 5:期間指定, 6:大引不成, 7:不成 |
| 9 | 注文期限 | string | △ | 訂正元の執行条件が「5:期間指定」の場合、訂正可能<br>YYYYMMDD形式 |
| 10 | 逆指値条件価格 | number | △ | 逆指値条件価格の訂正時入力<br>（注文区分が「1:逆指値付通常注文」or「2:逆指値注文」の場合、訂正可能） |
| 11 | 逆指値条件区分 | string | △ | 逆指値条件区分訂正時、1:以上, 2:以下を入力<br>（注文区分が「1:逆指値付通常注文」or「2:逆指値注文」の場合、訂正可能） |
| 12 | 逆指値価格区分 | string | △ | 逆指値区分訂正時、0:成行, 1:指値を入力<br>（注文区分が「1:逆指値付通常注文」or「2:逆指値注文」の場合、訂正可能） |
| 13 | 逆指値価格 | number | △ | 逆指値価格訂正時入力<br>（注文区分が「1:逆指値付通常注文」or「2:逆指値注文」の場合、訂正可能） |
| 14 | セット注文価格区分 | number | △ | セット注文価格区分訂正時に入力<br>1:指値, 2:値幅指定 |
| 15 | セット注文価格 | string | △ | セット注文価格を入力<br>（セット注文区分が「1:セット注文（予約する）」の場合、訂正可能） |
| 16 | セット注文執行条件 | string | △ | セット注文執行条件は訂正できません |
| 17 | セット注文期限 | string | △ | 訂正元の執行条件が「5:期間指定」の場合、訂正可能<br>YYYYMMDD形式 |

**凡例**: ● 必須, △ 省略可, ▲ 条件次第で省略可

## 訂正可能な項目

### 基本項目
| 項目 | 訂正可否 | 備考 |
|------|----------|------|
| 注文数量 | ○ | 未約定分のみ |
| 注文価格 | ○ | 制限値幅内 |
| 執行条件 | △ | 一部制限あり |
| 注文期間 | △ | 期間指定時のみ |

### 制限事項
- **注文区分**: 通常⇔逆指値付通常のみ変更可能
- **執行条件**: 今週中・期間指定以外は訂正可能
- **セット注文執行条件**: 訂正不可

## 使用例

### 基本的な価格訂正
```excel
=RssModifyOrder(7,1,123456,0,100,1,1110)
```
注文番号123456の価格を1110円に訂正

### 数量と価格の同時訂正
```excel
=RssModifyOrder(8,1,123457,0,200,1,1120)
```
注文番号123457の数量を200株、価格を1120円に訂正

### 通常注文から逆指値付通常注文に変更
```excel
=RssModifyOrder(9,1,123458,3,,,,,,,1150,2,1,1150)
```
注文番号123458を通常注文から逆指値付通常注文に変更

### 執行条件の訂正
```excel
=RssModifyOrder(10,1,123459,0,,,,,5,20241231)
```
注文番号123459の執行条件を期間指定（2024/12/31まで）に変更

## 戻り値

### 成功時の出力形式

**データ構造**: 単一セル
- **関数セル**: 訂正受付番号（文字列）

### 実際の出力例

#### 成功時の訂正受付番号
```excel
=RssModifyOrder(7,1,123456,0,100,1,1110)
```
結果：`M2024050800001` （文字列、訂正受付番号）

#### 注文区分変更
```excel
=RssModifyOrder(9,1,123458,3,,,,,,,1150,2,1,1150)
```
結果：`M2024050800002` （文字列、訂正受付番号）

### 訂正受付番号の形式

| 項目 | 形式 | 例 | 説明 |
|------|------|-----|------|
| 受付番号 | string | `M` + `YYYYMMDD` + 5桁連番 | `M2024050800001` |
| プレフィックス | string | `M` | 訂正取引識別コード |
| 日付部分 | string | `YYYYMMDD` | 訂正日（年月日） |
| 連番部分 | string | 5桁数字 | 日内連続番号 |

### 失敗時の出力

**データ構造**: 単一セル
- **関数セル**: エラーコード（Excel標準エラー）

**可能なエラーコード**:
- `#VALUE!` - パラメータ形式エラー、発注ID重複
- `#N/A` - 注文番号無効、訂正不可状態、市場休場等
- `#NUM!` - 数値パラメータの範囲外
- `#REF!` - セル参照エラー

### 特別なケース

#### 無効な注文番号
```excel
=RssModifyOrder(7,1,999999,0,100,1,1110)
```
結果：`#N/A`

#### 既に約定済み注文
```excel
=RssModifyOrder(7,1,123456,0,100,1,1110)  // 約定済み注文
```
結果：`#N/A`

#### 制限値幅外価格
```excel
=RssModifyOrder(7,1,123456,0,100,1,9999)  // 制限値幅外
```
結果：`#N/A`

#### 訂正不可の注文区分変更
```excel
=RssModifyOrder(7,1,123456,2,100,1,1110)  // 逆指値注文への変更
```
結果：`#VALUE!`

#### 市場休場時
```excel
=RssModifyOrder(7,1,123456,0,100,1,1110)  // 土日祝日
```
結果：`#N/A`

## エラーコード
| エラー | 原因 | 対処法 |
|--------|------|--------|
| #VALUE! | パラメータ形式エラー、無効な注文区分変更 | パラメータと注文区分の組み合わせを確認 |
| #N/A | 注文番号無効、訂正不可状態、市場休場等 | 注文番号、注文状況、市場時間を確認 |
| #NUM! | 数値パラメータの範囲外 | 注文数量、価格の妥当性を確認 |
| #REF! | セル参照エラー | セル参照の指定を確認 |

## 関連関数
- **RssStockOrder**: 現物注文
- **RssMarginOpenOrder**: 信用新規注文
- **RssCancelOrder**: 注文取消
- **RssOrderList**: 注文一覧（注文番号確認用）
- **RssOrderStatus**: 注文状況確認

## 注意事項

1. **注文番号**: RssOrderList関数で事前に確認が必要です
2. **訂正制限**: 約定後や取消後の注文は訂正できません
3. **市場時間**: 各市場の開場時間内で訂正可能です
4. **制限値幅**: 訂正後価格も制限値幅内である必要があります
5. **部分約定**: 部分約定した注文は未約定分のみ訂正可能です

## 訂正パターン例

### 価格のみ訂正
```excel
=RssModifyOrder(ID,1,注文番号,0,,,1,新価格)
```

### 数量のみ訂正
```excel
=RssModifyOrder(ID,1,注文番号,0,新数量)
```

### 成行から指値に変更
```excel
=RssModifyOrder(ID,1,注文番号,0,,1,指値価格)
```

### 通常注文を逆指値付に変更
```excel
=RssModifyOrder(ID,1,注文番号,3,,,,,,,条件価格,条件区分,価格区分,逆指値価格)
```

## バージョン情報
- RSS Version: 2.0
- 対応: Excel 2016以降
- 最終更新: 2024年

## 参考資料
- MARKETSPEED II RSS オンラインヘルプ
- 楽天証券 RSS関数マニュアル PDF