# RssMarginOpenOrder 非公式テスト確認仕様

## 概要
**関数名**: RssMarginOpenOrder  
**カテゴリ**: 注文管理 (Order Management)  
**用途**: 信用新規注文の発注  

**説明**: 信用取引での新規買建・売建注文を行います。制度信用、一般信用の各区分に対応し、逆指値やセット注文も可能です。

## 構文 (Syntax)

### Excel ワークシート関数
```excel
RssMarginOpenOrder(発注ID, 発注トリガー, 銘柄コード, 売買区分, 注文区分, SOR区分, 信用区分, 注文数量, 価格区分, 注文価格, 執行条件, 注文期限, 口座区分, 逆指値条件価格, 逆指値条件区分, 逆指値価格区分, 逆指値価格, セット注文区分, セット注文価格区分, セット注文価格, セット注文執行条件, セット注文期限)
```

### VBA関数
```vb
RssMarginOpenOrder_V(発注ID, 銘柄コード, 売買区分, 注文区分, SOR区分, 信用区分, 注文数量, 価格区分, 注文価格, 執行条件, 注文期限, 口座区分, 逆指値条件価格, 逆指値条件区分, 逆指値価格区分, 逆指値価格, セット注文区分, セット注文価格区分, セット注文価格, セット注文執行条件, セット注文期限)
```

## パラメータ詳細

| No | パラメータ名 | 通常注文 | 逆指値付通常注文 | 逆指値注文 | データ型 | 説明 |
|----|------------|---------|------------------|-----------|----------|------|
| 1 | 発注ID | ● | ● | ● | number | Excelから注文を一意に識別するための番号<br>(1以上2147483647以下の数値で入力) |
| 2 | 発注トリガー | ● | ● | ● | number | 0(False):待機, 1(True):発注<br>省略時は0(False):待機 |
| 3 | 銘柄コード | ● | ● | ● | string | 4-5桁英数字の銘柄コード<br>「.市場」は省略可（.T:東証, .JAX:JAX, .JNX:JNX） |
| 4 | 売買区分 | ● | ● | ● | string | 1:売り（売建）, 3:買い（買建） |
| 5 | 注文区分 | ● | ● | ● | string | 0:通常注文, 1:逆指値付注文, 2:逆指値待機注文 |
| 6 | SOR区分 | ● | ● | ● | string | 0:通常注文, 1:SOR注文 |
| 7 | 信用区分 | ● | ● | ● | string | 1:制度信用（6ヶ月）, 2:一般信用（無制限）, 3:一般信用（14日）, 4:一般信用（いちにち） |
| 8 | 注文数量 | ● | ● | ● | number | 注文する株数 |
| 9 | 価格区分 | ● | ● | - | string | 0:成行, 1:指値（逆指値注文時は不要） |
| 10 | 注文価格 | △ | △ | - | number | 指値の場合の価格 |
| 11 | 執行条件 | ● | ● | ● | string | 1:本日中, 2:今週中, 3:寄付, 4:引け, 5:期間指定, 6:大引不成, 7:不成 |
| 12 | 注文期限 | △ | △ | △ | string | 期間指定時のYYYYMMDD形式日付 |
| 13 | 口座区分 | ● | ● | ● | string | 0:特定, 1:一般 |
| 14 | 逆指値条件価格 | - | ● | ● | number | 逆指値の条件価格 |
| 15 | 逆指値条件区分 | - | ● | ● | string | 1:以上, 2:以下 |
| 16 | 逆指値価格区分 | - | ● | ● | string | 0:成行, 1:指値 |
| 17 | 逆指値価格 | - | ● | ● | number | 逆指値の価格 |
| 18 | セット注文区分 | △ | △ | △ | string | 0:通常（予約しない）, 1:セット注文（予約する） |
| 19 | セット注文価格区分 | △ | △ | △ | string | 1:指値, 2:値幅指定 |
| 20 | セット注文価格 | △ | △ | △ | number | セット注文の価格 |
| 21 | セット注文執行条件 | △ | △ | △ | string | 1:本日中, 2:今週中, 3:寄付, 4:引け, 5:期間指定, 6:大引不成, 7:不成 |
| 22 | セット注文期限 | △ | △ | △ | string | セット注文の期日（YYYYMMDD形式） |

**凡例**: ● 必須, △ 省略可, ▲ 条件次第で省略可, - 指定不要

## 使用例

### 基本的な新規買建注文
```excel
=RssMarginOpenOrder(5,1,4755,3,0,0,1,100,1,1100,1,,0)
```
楽天グループ（4755）を制度信用で100株、1,100円指値で新規買建注文

### 新規売建注文
```excel
=RssMarginOpenOrder(6,1,7203,1,0,0,1,100,1,2500,1,,0)
```
トヨタ自動車（7203）を制度信用で100株、2,500円指値で新規売建注文

### 一般信用での注文
```excel
=RssMarginOpenOrder(7,1,4755,3,0,0,2,100,1,1150,1,,0)
```
楽天グループを一般信用(無制限)で100株、1,150円指値で新規買建注文

## 戻り値

### 成功時の出力形式

**データ構造**: 単一セル
- **関数セル**: 発注受付番号（文字列）

### 実際の出力例

#### 成功時の発注受付番号
```excel
=RssMarginOpenOrder(5,1,4755,3,0,0,1,100,1,1100,1,,0)
```
結果：`M2024050800001` （文字列、受付番号）

#### 一般信用での発注
```excel
=RssMarginOpenOrder(7,1,4755,3,0,0,2,100,1,1150,1,,0)
```
結果：`M2024050800002` （文字列、受付番号）

### 発注受付番号の形式

| 項目 | 形式 | 例 | 説明 |
|------|------|-----|------|
| 受付番号 | string | `M` + `YYYYMMDD` + 5桁連番 | `M2024050800001` |
| プレフィックス | string | `M` | 信用取引識別コード |
| 日付部分 | string | `YYYYMMDD` | 発注日（年月日） |
| 連番部分 | string | 5桁数字 | 日内連続番号 |

### 失敗時の出力

**データ構造**: 単一セル
- **関数セル**: エラーコード（Excel標準エラー）

**可能なエラーコード**:
- `#VALUE!` - パラメータ形式エラー
- `#N/A` - 銘柄コード無効、市場休場、余力不足等
- `#NUM!` - 数値パラメータの範囲外
- `#REF!` - セル参照エラー

### 特別なケース

#### 市場休場時
```excel
=RssMarginOpenOrder(5,1,4755,3,0,0,1,100,1,1100,1,,0)
```
結果：`#N/A`

#### 余力不足
```excel
=RssMarginOpenOrder(5,1,4755,3,0,0,1,100,1,1100,1,,0)
```
結果：`#N/A` またはエラーメッセージを含む文字列

#### 無効な銘柄コード
```excel
=RssMarginOpenOrder(5,1,9999,3,0,0,1,100,1,1100,1,,0)
```
結果：`#N/A`

#### 同一発注ID重複使用
```excel
=RssMarginOpenOrder(5,1,4755,3,0,0,1,100,1,1100,1,,0)  // 既に使用済みのID
```
結果：`#VALUE!` またはエラーメッセージ

## エラーコード
| エラー | 原因 | 対処法 |
|--------|------|--------|
| #VALUE! | パラメータ形式エラー、発注ID重複 | パラメータの型と値、発注IDの重複を確認 |
| #N/A | 銘柄コード無効、市場休場、余力不足等 | 銘柄コード、市場時間、口座余力を確認 |
| #NUM! | 数値パラメータの範囲外 | 注文数量、価格の妥当性を確認 |
| #REF! | セル参照エラー | セル参照の指定を確認 |

## 関連関数
- **RssMarginCloseOrder**: 信用返済注文
- **RssMarginPositionList**: 信用建玉一覧（建玉状況確認）
- **RssOrderIDList**: 発注ID一覧
- **RssOrderStatus**: 注文状況確認
- **RssCancelOrder**: 注文取消

## 注意事項

1. **発注ID管理**: 同一発注IDの重複使用はエラーになります
2. **市場時間**: 発注は市場開場時間内に行う必要があります
3. **余力確認**: 十分な余力があることを事前に確認してください
4. **信用区分**: 制度信用と一般信用では条件が異なります
5. **VBA版との違い**: VBA版では発注トリガーパラメータが不要です

## 信用区分の詳細

### 制度信用（区分=1）
- **期限**: 6ヶ月以内
- **貸株料**: 年率約2.8%
- **逆日歩**: 発生する場合あり

### 一般信用（区分=2,3,4）
| 区分 | 種類 | 期限 | 特徴 |
|------|------|------|------|
| 2 | 無制限 | 無期限 | 長期保有可能 |
| 3 | 14日 | 14日以内 | 短期取引向け |
| 4 | ファンド | 特定期間 | ファンド専用 |

## バージョン情報
- RSS Version: 2.0
- 対応: Excel 2016以降
- 最終更新: 2024年

## 参考資料
- MARKETSPEED II RSS オンラインヘルプ
- 楽天証券 RSS関数マニュアル PDF