# RssBuyingPower 非公式テスト確認仕様

## 概要
**関数名**: RssBuyingPower  
**カテゴリ**: 口座・資産情報 (Account & Asset Information)  
**用途**: 余力情報（現物）の取得  

**説明**: 指定した国内株式の買付可能額を表示します。特定の銘柄を購入する際の現物買付余力を確認できます。

## 構文 (Syntax)

### Excel ワークシート関数
```excel
RssBuyingPower(ヘッダー行, 銘柄コード)
```

### VBA関数
```vb
RssBuyingPower_V(ヘッダー行, 銘柄コード)
```

## パラメータ詳細

| No | パラメータ名 | 必要性 | データ型 | 説明 |
|----|------------|--------|----------|------|
| 1 | ヘッダー行 | △ | セル参照 | 取得項目が入力されているセル範囲を指定します<br>省略時はすべての取得項目を表示します |
| 2 | 銘柄コード | ● | string | 数字4桁（or 5桁）<br>市場コードの指定は不要です |

**凡例**: ● 必須, △ 省略可, ▲ 条件次第で省略可, - 指定不要

## 使用例

### 基本的な余力情報取得
```excel
=RssBuyingPower(,"4755")
```
銘柄コード4755の現物買付可能額を取得（ヘッダー行省略）

### ヘッダー行指定での取得
```excel
=RssBuyingPower(A1,"4755")
```
A1セルにヘッダー項目を設定して、銘柄コード4755の買付可能額を取得

### 複数銘柄の買付可能額確認
```excel
// B列に銘柄コード、C列に買付可能額を表示
C1: =RssBuyingPower(,B1)
C2: =RssBuyingPower(,B2)
C3: =RssBuyingPower(,B3)
```

## 戻り値

### 成功時の出力形式

**データ構造**: 一覧形式（ただし出力は1項目）
- **ヘッダー行**: 「現物買付可能額」（省略時は自動生成）
- **データ行**: 指定銘柄の現物買付可能額（円）

### 出力項目

| No | 項目名 | データ型 | 説明 |
|----|--------|----------|------|
| 1 | 現物買付可能額 | number | 指定銘柄の現物買付可能額を表示（円） |

### 実際の出力例

#### ヘッダー行省略の場合
```excel
=RssBuyingPower(,"4755")
```
結果：
```
現物買付可能額
3962464
```

#### ヘッダー行指定の場合
```excel
// A1に「買付余力」と入力
A1: 買付余力
=RssBuyingPower(A1,"7203")
```
結果：
```
買付余力
3962464
```

### 失敗時の出力

**可能なエラー**:
- `銘柄コードは、4桁または5桁で入力してください。` - 銘柄コード形式エラー
- `ヘッダー行は、単一行のセル範囲で入力してください。` - ヘッダー行形式エラー
- `処理が完了しませんでした。もう一度お試しください。` - 存在しない銘柄等
- `#VALUE!` - パラメータ形式エラー
- `#N/A` - ログインエラー、サービス利用不可

## エラーコード
| エラー | 原因 | 対処法 |
|--------|------|--------|
| 銘柄コードは、4桁または5桁で入力してください | 銘柄コード形式エラー | 4桁または5桁の数字文字列を指定 |
| ヘッダー行は、単一行のセル範囲で入力してください | ヘッダー行形式エラー | 単一行のセル範囲を指定 |
| 処理が完了しませんでした | 銘柄が存在しない等 | 有効な銘柄コードを指定 |
| #VALUE! | パラメータ形式エラー | パラメータの型と値を確認 |
| #N/A | ログインエラー | ログイン状況を確認 |

## 活用例

### 購入前の余力確認
```excel
// A列: 銘柄コード
// B列: 現在株価
// C列: 購入希望数
// D列: 必要金額
// E列: 買付可能額

E2: =RssBuyingPower(,A2)
D2: =B2*C2
F2: =IF(E2>=D2, "購入可能", "余力不足")
```

### 複数銘柄の購入可能数計算
```excel
// 買付可能額÷株価で購入可能株数を計算
購入可能株数: =INT(RssBuyingPower(,A2)/B2/100)*100
```

### VBAでの活用
```vb
Sub CheckBuyingPower()
    Dim stockCode As String
    Dim buyingPower As Double
    
    stockCode = "4755"
    ' ヘッダー行を省略して買付可能額を取得
    buyingPower = Application.WorksheetFunction.RssBuyingPower_V(, stockCode)
    
    MsgBox "銘柄 " & stockCode & " の買付可能額: " & Format(buyingPower, "#,##0") & "円"
End Sub
```

## 関連関数
- **RssMarginPower**: 余力情報（信用）
- **RssCapacityList**: 余力・保証金率
- **RssFOPCapacityList**: 余力情報（先物OP）
- **RssPositionList**: 保有証券一覧
- **RssMarket**: 市況情報（現物株価取得）

## 注意事項

1. **銘柄コード必須**: 銘柄コードは必須パラメータです
2. **市場コード不要**: 銘柄コードに市場コード（.T等）は不要です
3. **自動更新なし**: この関数は自動更新対象外です（-）
4. **ログイン必要**: 楽天証券へのログインが必要です
5. **リアルタイム性**: 買付余力はリアルタイムで変動します
6. **手数料考慮**: 表示される金額は手数料を考慮していない場合があります
7. **口座種別**: 現物買付のみ対象（信用取引はRssMarginPower使用）

## 買付可能額の計算

買付可能額は以下の要素で決まります：
- 現金残高
- MRF残高
- 預り金
- 受渡未到来の売却代金
- その他の拘束金額

## 銘柄別の必要性

この関数が銘柄コードを必要とする理由：
- 銘柄により売買単位が異なる
- 値幅制限により必要証拠金が異なる
- 信用取引可能銘柄かどうかの判定
- その他銘柄固有の制約事項

## バージョン情報
- RSS Version: 2.0
- 対応: Excel 2016以降
- 最終更新: 2024年

## 参考資料
- MARKETSPEED II RSS オンラインヘルプ
- 楽天証券 RSS関数マニュアル PDF