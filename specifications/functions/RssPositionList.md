# RssPositionList 完全仕様書

## 概要
**関数名**: RssPositionList  
**カテゴリ**: ポジション管理 (Position Management)  
**用途**: 保有証券一覧の取得  

**説明**: 現在保有している国内株式の一覧をExcelに表示します。保有数量、評価額、含み損益等の情報を取得でき、ポートフォリオ管理や資産状況の把握に活用できます。

## 構文 (Syntax)

### Excel ワークシート関数
```excel
RssPositionList(引数列, ヘッダ行)
```

### VBA関数
```vb
RssPositionList_V(引数列, ヘッダ行)
```

## パラメータ詳細

| No | パラメータ名 | 必要性 | データ型 | 説明 |
|----|------------|--------|----------|------|
| 1 | 引数列 | ● | number | データ列の開始位置を指定する数値 |
| 2 | ヘッダ行 | ● | number | ヘッダ行の位置を指定する数値 |

**凡例**: ● 必須, △ 省略可, ▲ 条件次第で省略可, - 指定不要

## 使用例

### 基本的な保有証券一覧取得
```excel
=RssPositionList(A1, 1)
```
保有証券一覧をA1から表示、1行目にヘッダを配置

### 他の位置での保有一覧表示
```excel
=RssPositionList(E2, 3)
```
保有証券一覧をE2から表示、3行目にヘッダを配置

## 戻り値

### 成功時の出力形式

**データ構造**: マトリクス形式（配列）
- **ヘッダ行**: 項目名
- **データ行**: 各銘柄の保有状況詳細

### 実際の出力例

#### 保有証券一覧の出力
```excel
=RssPositionList(A1, 1)
```

| 銘柄コード | 銘柄名 | 保有数量 | 平均取得価格 | 現在価格 | 評価額 | 取得金額 | 含み損益 | 含み損益率 | 口座区分 | 保有区分 |
|-----------|--------|----------|--------------|----------|--------|----------|----------|-----------|----------|----------|
| 4755 | 楽天グループ | 200 | 1100.5 | 1140 | 228000 | 220100 | 7900 | 3.59% | 特定 | 現物 |
| 7203 | トヨタ自動車 | 100 | 2480.0 | 2500 | 250000 | 248000 | 2000 | 0.81% | 特定 | 現物 |
| 9984 | SBG | 100 | 9850.0 | 9720 | 972000 | 985000 | -13000 | -1.32% | NISA | 現物 |

### データ項目の詳細

| 項目 | データ型 | 説明 |
|------|----------|------|
| 銘柄コード | string | 4-5桁の銘柄コード |
| 銘柄名 | string | 銘柄の正式名称 |
| 保有数量 | number | 現在の保有株数 |
| 平均取得価格 | number | 複数回購入の平均取得価格 |
| 現在価格 | number | 最新の株価 |
| 評価額 | number | 現在価格×保有数量 |
| 取得金額 | number | 平均取得価格×保有数量（手数料等除く） |
| 含み損益 | number | 評価額-取得金額 |
| 含み損益率 | string | (含み損益÷取得金額)×100（%表示） |
| 口座区分 | string | 特定/一般/NISA/旧NISA |
| 保有区分 | string | 現物/信用 |

### 損益計算の詳細

```
評価額 = 現在価格 × 保有数量
取得金額 = 平均取得価格 × 保有数量
含み損益 = 評価額 - 取得金額
含み損益率 = (含み損益 ÷ 取得金額) × 100
```

### 失敗時の出力

**データ構造**: 単一セル
- **関数セル**: エラーコード（Excel標準エラー）

**可能なエラーコード**:
- `#VALUE!` - パラメータ形式エラー
- `#N/A` - ログインエラー、サービス利用不可
- `#REF!` - セル参照エラー

### 特別なケース

#### 保有証券がない場合
```excel
=RssPositionList(A1, 1)
```
結果：ヘッダ行のみ表示、データ行なし

#### 複数口座での保有
同一銘柄を異なる口座区分で保有している場合、それぞれ別行で表示される

| 銘柄コード | 銘柄名 | 保有数量 | 口座区分 |
|-----------|--------|----------|----------|
| 4755 | 楽天グループ | 100 | 特定 |
| 4755 | 楽天グループ | 200 | NISA |

## エラーコード
| エラー | 原因 | 対処法 |
|--------|------|--------|
| #VALUE! | パラメータ形式エラー | パラメータの型と値を確認 |
| #N/A | ログインエラー、サービス利用不可 | ログイン状況、サービス状況を確認 |
| #REF! | セル参照エラー | セル参照の指定を確認 |

## 関連関数
- **RssExecutionList**: 約定一覧（取得履歴確認）
- **RssOrderList**: 注文一覧
- **RssMarket**: リアルタイム株価取得
- **RssBuyingPower**: 余力情報（現物）
- **RssMarginPositionList**: 信用建玉一覧

## 注意事項

1. **リアルタイム更新**: 現在価格と評価額は市況に連動してリアルタイム更新されます
2. **ログイン必要**: 楽天証券へのログインが必要です
3. **手数料除外**: 取得金額には売買手数料は含まれていません
4. **配当権利**: 権利確定日の調整は自動的に反映されます
5. **セキュリティ**: 口座情報を含むため取り扱いに注意してください

## データ活用例

### ポートフォリオ分析
```excel
// 総評価額
=SUM(評価額列)

// 総含み損益
=SUM(含み損益列)

// 全体含み損益率
=SUM(含み損益列)/SUM(取得金額列)*100

// 銘柄数
=COUNTA(銘柄コード列)
```

### 銘柄別分析
```excel
// 最大ポジション銘柄
=INDEX(銘柄名列,MATCH(MAX(評価額列),評価額列,0))

// プラス銘柄数
=COUNTIF(含み損益列,">0")

// マイナス銘柄数  
=COUNTIF(含み損益列,"<0")
```

### 口座区分別集計
```excel
// NISA口座の総評価額
=SUMIF(口座区分列,"NISA",評価額列)

// 特定口座の含み損益
=SUMIF(口座区分列,"特定",含み損益列)
```

## 保有区分の詳細

### 現物保有
- **現物**: 実際に株式を保有している状態
- **配当権利**: 配当金受取権利あり
- **株主権利**: 議決権等の株主権利あり

### 信用建玉（RssMarginPositionListを参照）
- **買建**: 信用で買い建玉を保有
- **売建**: 信用で売り建玉を保有
- **期限あり**: 返済期限の管理が必要

## 口座区分別の税制

| 口座区分 | 税務処理 | 特徴 |
|----------|----------|------|
| 特定 | 源泉徴収あり | 売却時の税務処理自動化 |
| 一般 | 確定申告必要 | 年間損益計算が必要 |
| NISA | 非課税 | 売却益・配当金が非課税 |
| 旧NISA | 非課税 | 旧制度での非課税枠 |

## 平均取得価格の計算

### 複数回購入時の計算例
```
1回目: 100株を1,000円で購入 → 取得金額 100,000円
2回目: 200株を1,100円で購入 → 取得金額 220,000円
合計: 300株、総取得金額 320,000円
平均取得価格: 320,000円 ÷ 300株 = 1,066.67円
```

### 株式分割・併合時の調整
- **株式分割**: 株数増加、取得価格按分調整
- **株式併合**: 株数減少、取得価格按分調整
- **自動調整**: システムで自動的に調整処理

## バージョン情報
- RSS Version: 2.0
- 対応: Excel 2016以降
- 最終更新: 2024年

## 参考資料
- MARKETSPEED II RSS オンラインヘルプ
- 楽天証券 RSS関数マニュアル PDF