# RssPositionList 非公式テスト確認仕様

## 概要
**関数名**: RssPositionList  
**カテゴリ**: ポジション管理 (Position Management)  
**用途**: 保有銘柄一覧の取得  

**説明**: 国内株式の現物保有一覧を表示します。保有数量、評価額、含み損益等の情報を取得でき、ポートフォリオ管理や資産状況の把握に活用できます。

## 構文 (Syntax)

### Excel ワークシート関数
```excel
RssPositionList(ヘッダー行, 銘柄コード, 口座区分)
```

### VBA関数
```vb
RssPositionList_V(ヘッダー行, 銘柄コード, 口座区分)
```

## パラメータ詳細

| No | パラメータ名 | 必要性 | データ型 | 説明 |
|----|------------|--------|----------|------|
| 1 | ヘッダー行 | △ | セル参照 | 取得項目が入力されているセル範囲を指定します<br>省略時はすべての取得項目を表示します |
| 2 | 銘柄コード | △ | string | 数字4桁（or 5桁）<br>市場コードの指定は不要です<br>省略された場合は、全てとして扱います |
| 3 | 口座区分 | △ | string | A:全て、0:特定、1:一般、2:NISA、3:旧NISA<br>省略された場合は、「A」として扱います |

**凡例**: ● 必須, △ 省略可, ▲ 条件次第で省略可, - 指定不要

## 使用例

### 基本的な保有銘柄一覧取得（全項目）
```excel
=RssPositionList()
```
すべての保有銘柄項目を表示（ヘッダー行は自動生成）

### ヘッダー行指定での保有一覧
```excel
=RssPositionList(A1:R1)
```
A1:R1の範囲に指定された項目のみを表示

### 特定銘柄の保有確認
```excel
=RssPositionList(A1:R1, "4755")
```
銘柄コード4755の保有状況のみを表示

### 特定口座の保有一覧
```excel
=RssPositionList(A1:R1, "", "0")
```
特定口座の保有銘柄を表示

### NISA口座の保有確認
```excel
=RssPositionList(A1:R1, "", "2")
```
NISA口座の保有銘柄のみを表示

## 戻り値

### 成功時の出力形式

**データ構造**: ヘッダー行型（Type 3）配列
- **ヘッダー行**: 指定された項目名（省略時は全18項目）
- **データ行**: 各銘柄の保有状況詳細が複数行で表示

### 出力項目（全18項目）

| No | 項目名 | データ型 | 説明 |
|----|--------|----------|------|
| 1 | 銘柄コード | string | 証券コード協議会で定められた銘柄コード<br>5桁目が0の場合5桁目を削除して表示 |
| 2 | 銘柄名称 | string | 銘柄名称を表示 |
| 3 | 口座区分 | string | 口座区分を表示（一般、特定、NISA、旧NISA） |
| 4 | 保有数量 | number | 保有数量を表示 |
| 5 | 発注数量 | number | 発注数量を表示 |
| 6 | 平均取得価額 | number | 平均取得価額を表示 |
| 7 | 時価 | number | 時価を表示 |
| 8 | 前日比 | number | 前日比を表示 |
| 9 | 前日比率 | number | 前日比率を表示（%） |
| 10 | 時価評価額 | number | 時価評価額を表示 |
| 11 | 評価損益額 | number | 評価損益額を表示 |
| 12 | 評価損益率 | number | 評価損益率を表示（%） |
| 13 | 銘柄情報等 | string | 決算などの銘柄に関する情報を表示 |
| 14 | JAX時価 | number | JAX市場での時価を表示 |
| 15 | JNX時価 | number | JNX市場での時価を表示 |
| 16 | PER | number | PER（株価収益率）を表示 |
| 17 | PBR | number | PBR（株価純資産倍率）を表示 |
| 18 | 配当利回り | number | 配当利回りを表示（%） |

### 実際の出力例

#### 全項目表示の場合
```excel
=RssPositionList()
```

結果（A1から横方向に展開）：
| A列 | B列 | C列 | D列 | E列 | ... | R列 |
|-----|-----|-----|-----|-----|-----|-----|
| 銘柄コード | 銘柄名称 | 口座区分 | 保有数量 | 発注数量 | ... | 配当利回り |
| 4755 | 楽天グループ | 特定 | 200 | 0 | ... | 0.00 |
| 7203 | トヨタ自動車 | 特定 | 100 | 0 | ... | 1.80 |
| 9984 | SBG | NISA | 100 | 0 | ... | 0.44 |

#### ヘッダー行指定の場合
```excel
// A1:F1にヘッダー項目を設定
A1: 銘柄コード
B1: 銘柄名称  
C1: 保有数量
D1: 時価
E1: 時価評価額
F1: 評価損益額

=RssPositionList(A1:F1)
```

結果（指定した6項目のみ表示）：
| A列 | B列 | C列 | D列 | E列 | F列 |
|-----|-----|-----|-----|-----|-----|
| 銘柄コード | 銘柄名称 | 保有数量 | 時価 | 時価評価額 | 評価損益額 |
| 4755 | 楽天グループ | 200 | 1140 | 228000 | 7900 |
| 7203 | トヨタ自動車 | 100 | 2500 | 250000 | 2000 |

### 損益計算の詳細

```
時価評価額 = 時価 × 保有数量
評価損益額 = 時価評価額 - (平均取得価額 × 保有数量)
評価損益率 = (評価損益額 ÷ (平均取得価額 × 保有数量)) × 100
前日比 = 時価 - 前日終値
前日比率 = (前日比 ÷ 前日終値) × 100
```

### 失敗時の出力

**データ構造**: 単一セル
- **関数セル**: エラーコード（Excel標準エラー）

**可能なエラーコード**:
- `#VALUE!` - パラメータ形式エラー
- `#N/A` - ログインエラー、サービス利用不可
- `#REF!` - セル参照エラー
- エラーメッセージ - 「配信中」等のステータスメッセージ

### 特別なケース

#### 保有証券がない場合
```excel
=RssPositionList()
```
結果：ヘッダー行のみ表示、データ行なし

#### 複数口座での保有
同一銘柄を異なる口座区分で保有している場合、それぞれ別行で表示される

| 銘柄コード | 銘柄名称 | 口座区分 | 保有数量 |
|-----------|----------|----------|----------|
| 4755 | 楽天グループ | 特定 | 100 |
| 4755 | 楽天グループ | NISA | 200 |

## エラーコード
| エラー | 原因 | 対処法 |
|--------|------|--------|
| #VALUE! | パラメータ形式エラー | パラメータの型と値を確認 |
| #N/A | ログインエラー、サービス利用不可 | ログイン状況、サービス状況を確認 |
| #REF! | セル参照エラー | セル参照の指定を確認 |
| 配信中 | データ取得中 | しばらく待って再確認 |

## 関連関数
- **RssExecutionList**: 約定一覧（取得履歴確認）
- **RssOrderList**: 注文一覧
- **RssMarket**: リアルタイム株価取得
- **RssBuyingPower**: 余力情報（現物）
- **RssMarginPositionList**: 信用建玉一覧
- **RssCapacityList**: 余力・保証金率

## 注意事項

1. **ヘッダー行型関数**: この関数はType 3（ヘッダー行型）の関数です
2. **リアルタイム更新**: 時価と評価額は市況に連動してリアルタイム更新されます
3. **ログイン必要**: 楽天証券へのログインが必要です
4. **手数料除外**: 平均取得価額には売買手数料は含まれていません
5. **配当権利**: 権利確定日の調整は自動的に反映されます
6. **発注数量**: 現在発注中の数量が表示されます
7. **セキュリティ**: 口座情報を含むため取り扱いに注意してください

## データ活用例

### ポートフォリオ分析
```excel
// 総評価額
=SUM(時価評価額列)

// 総含み損益
=SUM(評価損益額列)

// 全体含み損益率
=SUM(評価損益額列)/SUMPRODUCT(平均取得価額列,保有数量列)*100

// 保有銘柄数
=COUNTA(銘柄コード列)-1  // ヘッダー行を除く
```

### 銘柄別分析
```excel
// 最大ポジション銘柄
=INDEX(銘柄名称列,MATCH(MAX(時価評価額列),時価評価額列,0))

// プラス銘柄数
=COUNTIF(評価損益額列,">0")

// マイナス銘柄数  
=COUNTIF(評価損益額列,"<0")
```

### 口座区分別集計
```excel
// NISA口座の総評価額
=SUMIF(口座区分列,"NISA",時価評価額列)

// 特定口座の含み損益
=SUMIF(口座区分列,"特定",評価損益額列)

// 一般口座の保有銘柄数
=COUNTIF(口座区分列,"一般")
```

## 市場別時価の活用

### 最良執行確認
- **時価**: 主市場（東証）の価格
- **JAX時価**: JAX市場での価格
- **JNX時価**: JNX市場での価格

複数市場の価格を比較して最良執行を確認できます。

## 投資指標の活用

### ファンダメンタル分析
- **PER（株価収益率）**: 株価÷1株当たり純利益
- **PBR（株価純資産倍率）**: 株価÷1株当たり純資産
- **配当利回り**: 年間配当金÷株価×100

これらの指標を使用して割安・割高判断が可能です。

## 口座区分による税制上の扱い

| 口座区分 | 税務処理 | 年間上限 | 特徴 |
|----------|----------|----------|------|
| 特定 | 源泉徴収あり | なし | 売却時の税務処理自動化 |
| 一般 | 確定申告必要 | なし | 年間損益計算が必要 |
| NISA | 非課税 | 360万円 | 売却益・配当金が非課税 |
| 旧NISA | 非課税 | 120万円 | 旧制度での非課税枠 |

## 平均取得価額の計算

### 複数回購入時の計算例
```
1回目: 100株を1,000円で購入 → 取得金額 100,000円
2回目: 200株を1,100円で購入 → 取得金額 220,000円
合計: 300株、総取得金額 320,000円
平均取得価額: 320,000円 ÷ 300株 = 1,066.67円
```

### 株式分割・併合時の調整
- **株式分割**: 株数増加、平均取得価額を按分調整
- **株式併合**: 株数減少、平均取得価額を按分調整
- **自動調整**: システムで自動的に調整処理

## バージョン情報
- RSS Version: 2.0
- 対応: Excel 2016以降
- 最終更新: 2024年

## 参考資料
- MARKETSPEED II RSS オンラインヘルプ
- 楽天証券 RSS関数マニュアル PDF