# RssFOPModifyOrder 非公式テスト確認仕様

## 概要
**関数名**: RssFOPModifyOrder  
**カテゴリ**: 先物OP注文管理 (Futures & Options Order Management)  
**用途**: 先物OP訂正注文の発注  

**説明**: 指定した注文について、注文区分ごとに先物オプションの訂正注文を出します。価格、期限、逆指値条件の変更が可能です。

## 構文 (Syntax)

### Excel ワークシート関数
```excel
RssFOPModifyOrder(発注ID, 発注トリガー, 注文番号, 注文区分, 注文価格, 注文期限, 逆指値条件価格, 逆指値条件区分, 逆指値価格)
```

### VBA関数
```vb
RssFOPModifyOrder_V(発注ID, 注文番号, 注文区分, 注文価格, 注文期限, 逆指値条件価格, 逆指値条件区分, 逆指値価格)
```
※VBA関数は第2引数の「発注トリガー」を除いた入力形式となります

## パラメータ詳細

| No | パラメータ名 | 必要性 | データ型 | 説明 |
|----|------------|--------|----------|------|
| 1 | 発注ID | ● | 数値 | Excelから注文を一意に識別するための番号（1以上の数値で入力。） |
| 2 | 発注トリガー | ● | 数値 | 0（False）:待機、1（True）:発注 （省略時は、「0（False）:待機」）<br>（直接True/Falseを入力可。また、数式入力も可。） |
| 3 | 注文番号 | ● | 数値 | 訂正対象明細の注文番号を入力。 |
| 4 | 注文区分 | ● | 文字列 | 訂正元の注文区分を入力<br>0:通常注文、1:逆指値付通常注文、2:逆指値注文<br>訂正元の注文区分を訂正する場合、<br>3:通常注文⇒逆指値付通常注文、4:逆指値付通常注文⇒通常注文 |
| 5 | 注文価格 | △ | 数値 | 注文価格の訂正時入力。<br>（注文区分が「0:通常注文」 or 「1:逆指値付通常注文」 の場合、訂正可能。） |
| 6 | 注文期限 | △ | 文字列 | 訂正元の執行条件が「5:期間指定」の場合、訂正可能。(YYYYMMDD) |
| 7 | 逆指値条件価格 | △ | 数値 | 逆指値条件価格の訂正時入力。<br>（注文区分が「1:逆指値付通常注文」 or 「2:逆指値注文」の場合、訂正可能。） |
| 8 | 逆指値条件区分 | △ | 文字列 | 逆指値条件区分訂正時、1:以上、2:以下を入力。<br>（注文区分が「1:逆指値付通常注文」 or 「2:逆指値注文」の場合、訂正可能。） |
| 9 | 逆指値価格 | △ | 数値 | 逆指値価格訂正時入力。<br>（注文区分が「1:逆指値付通常注文」 or 「2:逆指値注文」の場合、訂正可能。） |

**凡例**: ● 必須, △ 省略可, ▲ 条件次第で省略可, - 指定不要

**重要**: 任意項目は、訂正項目のみ入力してください

## 使用例

### 通常注文の価格訂正
```excel
=RssFOPModifyOrder(1, 1, 1234567890, "0", 38600, , , , )
```
注文番号1234567890の注文価格を38600に訂正

### 逆指値条件の訂正
```excel
=RssFOPModifyOrder(2, 1, 1234567891, "2", , , 38000, "2", 37900)
```
逆指値注文の条件価格と逆指値価格を訂正

### 期間指定の訂正
```excel
=RssFOPModifyOrder(3, 1, 1234567892, "0", 38500, "20241210", , , )
```
注文価格と注文期限を訂正

### 注文区分の変更（通常⇒逆指値付）
```excel
=RssFOPModifyOrder(4, 1, 1234567893, "3", 38600, , 38000, "1", 38700)
```
通常注文を逆指値付通常注文に変更

## 戻り値

### 成功時の出力
**データ型**: 文字列  
**内容**: 訂正結果を表示（「上記に同じ」等）

### 失敗時の出力
**可能なエラー**:
- `#VALUE!` - パラメータ形式エラー
- `#N/A` - ログインエラー、先物OP口座未開設
- `注文が見つかりません。` - 指定した注文番号が存在しない
- `訂正できません。` - 約定済み、取消済みなど訂正不可の状態

## エラーコード
| エラー | 原因 | 対処法 |
|--------|------|--------|
| #VALUE! | パラメータ形式エラー | パラメータの型と値を確認 |
| #N/A | ログインエラー、先物OP口座未開設 | ログイン状況、口座開設状況を確認 |
| 注文が見つかりません | 指定した注文番号が無効 | 正しい注文番号を指定 |
| 訂正できません | 注文状態が訂正不可 | 注文状態を確認 |

## 活用例

### 市況に応じた価格調整
```excel
// 現在価格を参照して注文価格を調整
=RssFOPModifyOrder(1, 1, A2, "0", B2+100, , , , )
```

### 複数注文の一括訂正
```excel
// 複数行に配置して同時訂正
A1: =RssFOPModifyOrder(1, C1, D1, "0", E1, , , , )
A2: =RssFOPModifyOrder(2, C2, D2, "0", E2, , , , )
A3: =RssFOPModifyOrder(3, C3, D3, "0", E3, , , , )
```

### VBAでの活用
```vb
Sub ModifyFOPOrder()
    Dim result As String
    Dim orderNo As Long
    Dim newPrice As Double
    
    orderNo = 1234567890
    newPrice = 38600
    
    ' VBA関数では発注トリガーを除く
    result = Application.WorksheetFunction.RssFOPModifyOrder_V( _
        1, orderNo, "0", newPrice, "", "", "", "")
    
    If result <> "#VALUE!" And result <> "#N/A" Then
        MsgBox "注文が訂正されました: " & result
    Else
        MsgBox "訂正エラー: " & result
    End If
End Sub
```

## 関連関数
- **RssFOPOpenOrder**: 先物OP新規注文
- **RssFOPCloseOrder**: 先物OP決済注文
- **RssFOPCancelOrder**: 先物OP取消注文
- **RssFOPOrderList**: 先物OP注文一覧
- **RssOrderStatus**: 注文状況取得

## 注意事項

1. **自動更新対応**: この関数は自動更新対象です（○）
2. **ログイン必要**: 楽天証券へのログインが必要です
3. **先物OP口座必要**: 先物・オプション取引口座の開設が必要です
4. **発注IDの一意性**: 発注IDは一意である必要があります
5. **VBA関数の違い**: VBA関数は第2引数の「発注トリガー」を除いた形式です
6. **訂正可能項目**: 任意項目のみ訂正可能、訂正項目のみ入力
7. **数量訂正不可**: この関数では注文数量の訂正はできません
8. **執行条件制限**: 執行条件の一部は訂正できません

## パラメータの説明

### 注文区分の詳細
- **0:通常注文** - 通常の指値または成行注文
- **1:逆指値付通常注文** - 逆指値条件付きの通常注文
- **2:逆指値注文** - 逆指値条件のみの注文
- **3:通常⇒逆指値付** - 通常注文を逆指値付通常注文に変更
- **4:逆指値付⇒通常** - 逆指値付通常注文を通常注文に変更

### 訂正可能な項目
| 項目 | 通常注文 | 逆指値付通常 | 逆指値注文 |
|------|----------|--------------|------------|
| 注文価格 | ○ | ○ | × |
| 注文期限 | ○ | ○ | ○ |
| 逆指値条件価格 | × | ○ | ○ |
| 逆指値条件区分 | × | ○ | ○ |
| 逆指値価格 | × | ○ | ○ |

### 訂正不可の項目
- **注文数量**: 数量の訂正は不可
- **銘柄コード**: 銘柄の変更は不可
- **売買区分**: 売買方向の変更は不可
- **執行数量条件**: FOK/FAK/FASの変更は不可
- **一部の執行時間条件**: 当セッション、引けなど

## 訂正タイミング

### 訂正可能な状態
- **待機中**: 逆指値待機中の注文
- **未約定**: まだ約定していない注文
- **一部約定**: 部分的に約定した注文の残数量部分

### 訂正不可の状態
- **全約定済み**: 完全に約定した注文
- **取消済み**: 既に取消された注文
- **失効**: 期限切れで失効した注文
- **執行中**: 市場で執行処理中の注文

## 注文区分変更の注意点

### 通常⇒逆指値付（区分3）
- 通常注文に逆指値条件を追加
- 逆指値条件価格、条件区分、逆指値価格の入力が必要

### 逆指値付⇒通常（区分4）
- 逆指値条件を削除して通常注文に変更
- 逆指値関連パラメータは無視される

## バージョン情報
- RSS Version: 2.0
- 対応: Excel 2016以降
- 最終更新: 2024年

## 参考資料
- MARKETSPEED II RSS オンラインヘルプ
- 楽天証券 RSS関数マニュアル PDF