# RssCapacityList 非公式テスト確認仕様

## 概要
**関数名**: RssCapacityList  
**カテゴリ**: 口座・資産情報 (Account & Asset Information)  
**用途**: 余力・保証金率の取得  

**説明**: 口座の現物買付余力、信用新規建余力等を表示します。現物取引および信用取引の余力情報を一覧で確認できます。

## 構文 (Syntax)

### Excel ワークシート関数
```excel
RssCapacityList(ヘッダー行)
```

### VBA関数
```vb
RssCapacityList_V(ヘッダー行)
```

## パラメータ詳細

| No | パラメータ名 | 必要性 | データ型 | 説明 |
|----|------------|--------|----------|------|
| 1 | ヘッダー行 | △ | セル参照 | 取得項目が入力されているセル範囲を指定します<br>省略時はすべての取得項目を表示します |

**凡例**: ● 必須, △ 省略可, ▲ 条件次第で省略可, - 指定不要

## 使用例

### 基本的な余力・保証金情報取得
```excel
=RssCapacityList()
```
全ての余力・保証金率情報を取得（ヘッダー行省略）

### ヘッダー行指定での取得
```excel
=RssCapacityList(A1:G1)
```
A1:G1セルにヘッダー項目を設定して、必要な項目のみを取得

### 特定項目のみ取得
```excel
// A5:C5に必要な項目名を入力
A5: 現物買付可能額
B5: 信用口座_信用新規建余力
C5: 信用口座_保証金率（新規建）
=RssCapacityList(A5:C5)
```

## 戻り値

### 成功時の出力形式

**データ構造**: 一覧形式
- **ヘッダー行**: 項目名（省略時は自動生成）
- **データ行**: 各項目の値

### 出力項目

| No | 項目名 | データ型 | 説明 |
|----|--------|----------|------|
| 1 | 現物買付可能額 | number | 現物買付可能額を表示（円） |
| 2 | 信用口座_保証金余裕額 | string/number | 保証金余裕額を表示、信用口座未開設は「－」を表示 |
| 3 | 信用口座_信用新規建余力 | string/number | 信用新規建余力を表示、信用口座未開設は「－」を表示 |
| 4 | 信用口座_保証金率（新規建） | string/number | 保証金率を表示（%）、信用口座未開設は「－」を表示 |
| 5 | 自動振替含む_保証金余裕額 | string/number | 自動振替を含んだ保証金余裕額を表示、信用口座未開設は「－」を表示 |
| 6 | 自動振替含む_信用新規建余力 | string/number | 自動振替を含んだ信用新規建余力を表示、信用口座未開設は「－」を表示 |
| 7 | 自動振替含む_保証金率（新規建） | string/number | 自動振替を含んだ保証金率を表示（%）、信用口座未開設は「－」を表示 |

### 実際の出力例

#### ヘッダー行省略の場合
```excel
=RssCapacityList()
```
結果：
```
現物買付可能額    信用口座_保証金余裕額    信用口座_信用新規建余力    信用口座_保証金率（新規建）    自動振替含む_保証金余裕額    自動振替含む_信用新規建余力    自動振替含む_保証金率（新規建）
3962464          2000000                5412123                   250.5                         2500000                     6000000                       280.0
```

#### 信用口座未開設の場合
```excel
=RssCapacityList()
```
結果：
```
現物買付可能額    信用口座_保証金余裕額    信用口座_信用新規建余力    信用口座_保証金率（新規建）    自動振替含む_保証金余裕額    自動振替含む_信用新規建余力    自動振替含む_保証金率（新規建）
3962464          －                      －                       －                           －                         －                           －
```

#### ヘッダー行指定の場合
```excel
// A1:C1にヘッダー項目を入力
A1: 現物買付可能額
B1: 信用口座_信用新規建余力
C1: 信用口座_保証金率（新規建）
=RssCapacityList(A1:C1)
```
結果：
```
現物買付可能額    信用口座_信用新規建余力    信用口座_保証金率（新規建）
3962464          5412123                   250.5
```

### 失敗時の出力

**可能なエラー**:
- `ヘッダー行に有効な項目名が存在しません。` - ヘッダー行に正しい項目名がない
- `ヘッダー行は、単一行のセル範囲で入力してください。` - ヘッダー行形式エラー
- `#VALUE!` - パラメータ形式エラー
- `#N/A` - ログインエラー、サービス利用不可

## エラーコード
| エラー | 原因 | 対処法 |
|--------|------|--------|
| ヘッダー行に有効な項目名が存在しません | ヘッダー行に正しい項目名がない | 正しい項目名を指定 |
| ヘッダー行は、単一行のセル範囲で入力してください | ヘッダー行形式エラー | 単一行のセル範囲を指定 |
| #VALUE! | パラメータ形式エラー | パラメータの型と値を確認 |
| #N/A | ログインエラー | ログイン状況を確認 |

## 活用例

### 余力チェックダッシュボード
```excel
// A1に関数を配置
=RssCapacityList()

// 条件付き書式で余力不足を警告
// 現物買付可能額が100万円未満で赤色表示
```

### 信用取引可能額の監視
```excel
// 信用新規建余力のみ取得
A1: 信用口座_信用新規建余力
=RssCapacityList(A1)

// 値をVLOOKUPで参照
=VLOOKUP("信用口座_信用新規建余力", A2:B3, 2, FALSE)
```

### VBAでの活用
```vb
Sub CheckCapacity()
    Dim capacityData As Variant
    
    ' ヘッダー行を省略して全項目取得
    capacityData = Application.WorksheetFunction.RssCapacityList_V()
    
    ' 現物買付可能額を確認（2行3列目が値）
    Dim buyingPower As Double
    buyingPower = capacityData(3, 1)
    
    If buyingPower < 1000000 Then
        MsgBox "現物買付可能額が100万円を下回っています: " & Format(buyingPower, "#,##0") & "円"
    End If
End Sub
```

## 関連関数
- **RssBuyingPower**: 余力情報（現物）- 特定銘柄の買付可能額
- **RssMarginPower**: 余力情報（信用）- 特定銘柄の信用新規建余力
- **RssFOPCapacityList**: 余力情報（先物OP）
- **RssPositionList**: 保有銘柄一覧
- **RssMarginPositionList**: 信用建玉一覧

## 注意事項

1. **自動更新なし**: この関数は自動更新対象外です（-）
2. **ログイン必要**: 楽天証券へのログインが必要です
3. **信用口座の状態**: 信用口座未開設の場合は該当項目に「－」が表示されます
4. **自動振替の設定**: 自動振替の有無により表示される値が異なります
5. **リアルタイム性**: 余力情報はリアルタイムで変動します
6. **項目名の正確性**: ヘッダー行を指定する場合は項目名を正確に入力する必要があります

## 項目の説明

### 現物買付可能額
- 現物株式の買付に使用できる金額
- MRF、預り金等を含む

### 信用口座_保証金余裕額
- 信用取引で使用できる保証金の余裕額
- 最低保証金維持率を考慮した金額

### 信用口座_信用新規建余力
- 新規に信用建玉を建てられる金額
- 保証金率を考慮した最大建玉可能額

### 信用口座_保証金率（新規建）
- 新規建玉時の保証金率
- パーセント表示（%記号なし）

### 自動振替含む
- 現物買付余力から信用保証金への自動振替を含めた場合の各数値
- 自動振替設定が有効な場合のみ意味がある

## バージョン情報
- RSS Version: 2.0
- 対応: Excel 2016以降
- 最終更新: 2024年

## 参考資料
- MARKETSPEED II RSS オンラインヘルプ
- 楽天証券 RSS関数マニュアル PDF