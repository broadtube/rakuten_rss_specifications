# RssFOPCode 完全仕様書

## 概要
**関数名**: RssFOPCode  
**カテゴリ**: 市場データ (Market Data)  
**用途**: 先物OPコード検索・取得  

**説明**: 先物OPの銘柄コードを表示します。商品種類、限月、コール/プット区分、行使価格を指定して、対応する銘柄コードを取得できます。

## 構文 (Syntax)

```excel
RssFOPCode(銘柄種類, 限月, C/P区分, 行使価格)
```

## パラメータ詳細

| No | パラメータ名 | データ型 | 必須/任意 | 説明 |
|----|------------|----------|-----------|------|
| 1 | 銘柄種類 | string | 必須 | 商品の種類コード（下記商品一覧参照） |
| 2 | 限月 | string | 任意 | 21年3月限の場合「202103」<br>ウィークリーオプション時は語尾に「#n」を指定<br>（例：21年3月限4週「202103#4」）<br>金スポット、プラチナスポット時は入力不要 |
| 3 | C/P区分 | string | 任意 | **1**: コール、**2**: プット<br>（日経225オプション時は必須、それ以外は省略） |
| 4 | 行使価格 | string | 任意 | 行使価格を入力する<br>（日経225オプション時は必須、それ以外は省略） |

## 主要商品一覧

### 指数先物・オプション
| 商品種類コード | 商品名 | 説明 |
|----------------|--------|------|
| N225F | 日経225先物 | 日経平均先物 |
| N225MF | 日経225ミニ | 日経225ミニ先物 |
| N225UF | 日経225マイクロ | 日経225マイクロ先物 |
| MOTF | 東証グロース市場250指数先物 | 旧マザーズ指数先物 |
| N225OP | 日経225オプション | 日経225オプション |
| N225MOP | 日経225ミニオプション | 日経225ミニオプション |
| N225C | 日経オプションコール | コールオプション |
| N225P | 日経オプションプット | プットオプション |

### 貴金属先物
| 商品種類コード | 商品名 | 説明 |
|----------------|--------|------|
| GOLDF | 金 | 金先物 |
| GOLDMINIF | 金ミニ | 金ミニ先物 |
| GOLDSPOTF | 金スポット | 金スポット |
| PLATINUMF | プラチナ | プラチナ先物 |
| PLATINUMMINIF | プラチナミニ | プラチナミニ先物 |
| PLATINUMSPOTF | プラチナスポット | プラチナスポット |
| SILVERF | 銀 | 銀先物 |
| PALLADIUMF | パラジウム | パラジウム先物 |

### 商品先物
| 商品種類コード | 商品名 | 説明 |
|----------------|--------|------|
| RSS3F | ゴム (RSS3) | 天然ゴム |
| TSR20F | ゴム (TSR20) | タイヤ用ゴム |
| CORNF | とうもろこし | トウモロコシ先物 |
| SOYBEANF | 一般大豆 | 大豆先物 |
| REDBEANF | 小豆 | 小豆先物 |

## 使用例

### 日経225先物コードの取得
```excel
=RssFOPCode("N225F", "202106")
```
日経225先物の2021年6月限のコードを取得します。

### 日経225オプションの取得
```excel
=RssFOPCode("N225OP", "202106", "1", "28000")
```
2021年6月限、コール、行使価格28000円のオプションコードを取得します。

### プットオプションの取得
```excel
=RssFOPCode("N225OP", "202106", "2", "27000")
```
2021年6月限、プット、行使価格27000円のオプションコードを取得します。

### ウィークリーオプション
```excel
=RssFOPCode("N225OP", "202103#4", "1", "29000")
```
2021年3月限第4週のウィークリーコールオプションを取得します。

### 貴金属先物
```excel
=RssFOPCode("GOLDF", "202106")      // 金先物6月限
=RssFOPCode("GOLDSPOTF")            // 金スポット（限月不要）
=RssFOPCode("PLATINUMF", "202109")  // プラチナ先物9月限
```

### ミニ先物
```excel
=RssFOPCode("N225MF", "202106")     // 日経225ミニ6月限
=RssFOPCode("GOLDMINIF", "202106")  // 金ミニ6月限
```

## 戻り値

### 成功時の出力形式

**データ構造**: 単一セル
- **関数セル**: 銘柄コード（文字列または数値）

### 実際の出力例

#### 日経225先物のコード取得
```excel
=RssFOPCode("N225F", "202406")
```
結果：`165120018` （数値、9桁）

#### 日経225コールオプション
```excel
=RssFOPCode("N225OP", "202406", "1", "28000")
```
結果：`165234567` （数値、9桁）

#### 日経225プットオプション
```excel
=RssFOPCode("N225OP", "202406", "2", "27000")
```
結果：`165789012` （数値、9桁）

#### 金先物のコード取得
```excel
=RssFOPCode("GOLDF", "202406")
```
結果：`167845123` （数値、9桁）

#### 金スポット
```excel
=RssFOPCode("GOLDSPOTF")
```
結果：`169999999` （数値、9桁）

#### ウィークリーオプション
```excel
=RssFOPCode("N225OP", "202403#4", "1", "29000")
```
結果：`165456789` （数値、9桁）

### 銘柄コードの形式

| 要素 | データ型 | 値の範囲・形式 | 例 | 備考 |
|------|----------|----------------|-----|------|
| 全体 | number/string | 9桁数字 | `165120018` | 固定長9文字 |
| 商品分類 | string | 最初1-2桁 | `16` | 先物OP商品識別 |
| 限月部分 | string | 中間6-7桁目 | `51` | 限月情報 |
| 連番部分 | string | 末尾2-3桁 | `18` | 同一条件内連番 |

### 商品別コード範囲

| 商品タイプ | コード範囲 | 例 | 特徴 |
|------------|----------|-----|------|
| 日経225先物 | 165000000-165999999 | `165120018` | 最も一般的 |
| 日経225ミニ | 163000000-163999999 | `163120015` | ミニ商品 |
| 日経225OP | 140000000-159999999 | `145234567` | オプション商品 |
| TOPIX先物 | 166000000-166999999 | `166120020` | 指数先物 |
| 金先物 | 167000000-167999999 | `167845123` | 貴金属商品 |
| ゴム先物 | 175000000-175999999 | `175620045` | 商品先物 |
| スポット商品 | 169000000-169999999 | `169999999` | スポット取引 |

### 失敗時の出力

**データ構造**: 単一セル
- **関数セル**: エラーコード（Excel標準エラー）

**可能なエラーコード**:
- `#VALUE!` - パラメータ形式エラー
- `#N/A` - 該当銘柄なし、限月存在しない等
- `#REF!` - セル参照エラー

### 特別なケース

#### 無効な商品種類コード
```excel
=RssFOPCode("INVALID", "202406")
```
結果：`#VALUE!`

#### 存在しない限月
```excel
=RssFOPCode("N225F", "202413")  // 13月は存在しない
```
結果：`#N/A`

#### オプションのパラメータ不足
```excel
=RssFOPCode("N225OP", "202406")  // C/P区分、行使価格なし
```
結果：`#VALUE!`

#### 存在しない行使価格
```excel
=RssFOPCode("N225OP", "202406", "1", "99999")  // 非現実的な行使価格
```
結果：`#N/A`

#### 限月形式エラー
```excel
=RssFOPCode("N225F", "21-06")  // YYYYMM形式ではない
```
結果：`#VALUE!`

#### ウィークリーオプションの週指定エラー
```excel
=RssFOPCode("N225OP", "202403#6", "1", "28000")  // 6週目は存在しない
```
結果：`#N/A`

#### スポット商品に限月指定
```excel
=RssFOPCode("GOLDSPOTF", "202406")  // スポットに限月は不要
```
結果：`#VALUE!` または限月を無視して処理

## エラーコード
| エラー | 原因 | 対処法 |
|--------|------|--------|
| #VALUE! | パラメータ形式エラー | 商品種類コード、限月形式を確認 |
| #N/A | 該当銘柄なし | 限月、行使価格の存在を確認 |
| #REF! | セル参照エラー | セル参照の指定を確認 |

## 関連関数
- **RssFOPMarket**: 先物OP市況情報（取得したコードで市況データ取得）
- **RssFOPMarketDes**: 先物OP銘柄情報
- **RssMarketHeader**: 市況情報ヘッダー行作成

## 注意事項

1. **限月の正確性**: 存在しない限月を指定するとエラーになります
2. **オプション必須項目**: 日経225オプションはC/P区分と行使価格が必須
3. **商品種類コード**: 正確な商品種類コードを指定する必要があります
4. **ウィークリーオプション**: 「#n」形式で週を指定
5. **スポット商品**: 金・プラチナスポットは限月指定不要

## 限月の指定形式

### 通常限月
- **YYYYMM形式**: 202106（2021年6月限）
- **例**: 202103, 202106, 202109, 202112

### ウィークリーオプション
- **YYYYMM#n形式**: 202103#4（2021年3月第4週）
- **週番号**: #1, #2, #3, #4, #5

## オプション行使価格の例

### 日経225オプション
一般的な行使価格の刻み：
- **ATM周辺**: 250円刻み（27000, 27250, 27500...）
- **OTM**: 500円刻み（26000, 26500, 27000...）

### 取得したコードの活用
```excel
// 1. コード取得
=RssFOPCode("N225F", "202106")
// 結果例: 165120018

// 2. 市況データ取得
=RssFOPMarket("165120018", "現在値")
```

## 実用的な活用例

### オプション戦略での利用
```excel
// ATMコールの取得
=RssFOPCode("N225OP", "202106", "1", "28000")

// ATMプットの取得  
=RssFOPCode("N225OP", "202106", "2", "28000")

// ストラドル戦略で両方のコードを取得
```

### 限月ロールオーバー
```excel
// 期近限月
=RssFOPCode("N225F", "202103")

// 期先限月
=RssFOPCode("N225F", "202106")
```

## バージョン情報
- RSS Version: 2.0
- 対応: Excel 2016以降
- 最終更新: 2024年

## 参考資料
- MARKETSPEED II RSS オンラインヘルプ
- MARKETSPEED II オンラインヘルプ「先物OPコード検索」