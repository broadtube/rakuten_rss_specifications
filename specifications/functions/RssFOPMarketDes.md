# RssFOPMarketDes 非公式テスト確認仕様

## 概要
**関数名**: RssFOPMarketDes  
**カテゴリ**: 市場データ (Market Data)  
**用途**: 先物OP銘柄情報の取得  

**説明**: 指定された先物OPの銘柄情報をExcelに表示します。制限値幅上限・下限等の取引に必要な先物OP銘柄基本情報を取得できます。

## 構文 (Syntax)

```excel
RssFOPMarketDes(ヘッダー行, "銘柄コード")
```

## パラメータ詳細

| No | パラメータ名 | データ型 | 必須/任意 | 説明 |
|----|------------|----------|-----------|------|
| 1 | ヘッダー行 | セル参照 | 任意 | 取得項目をセル範囲で指定。範囲指定は1行のみ（A1:C1形式）<br>省略時は全ての出力項目を表示。取得項目は出力項目から選択可能 |
| 2 | 銘柄コード | string | 必須 | **9桁**: 国内先物OP<br>**N225.YYYYMM.C**: 225先物CME<br>**N225.YYYYMM.S**: 225先物SGX<br>※YYYYMMは限月を指定 |

## 主要な出力項目

| No | 項目名 | 説明 | データ型 |
|----|--------|------|----------|
| 1 | 制限値幅上限 | 値幅制限の上限価格 | number |
| 2 | 制限値幅下限 | 値幅制限の下限価格 | number |

## 先物OP制限値幅について

先物・オプション取引では、価格の急激な変動を防ぐため制限値幅が設定されます。

### 制限値幅の特徴
- **基準価格**: 前日清算価格（SQ算出日等は特別基準）
- **動的調整**: 市況により制限値幅が拡大される場合あり
- **商品別設定**: 各商品により異なる制限値幅

### 先物の制限値幅例
| 商品 | 制限値幅 |
|------|----------|
| 日経225先物 | ±2500円程度 |
| 日経225ミニ | ±2500円程度 |
| TOPIX先物 | ±200ポイント程度 |
| 金先物 | ±200円程度 |

## 使用例

### 基本的な使用方法
```excel
=RssFOPMarketDes(, "165120018")
```
A1セルに入力すると、指定した先物OPについて銘柄情報の全取得項目を表示します。

### ヘッダー行を指定した取得
```excel
=RssFOPMarketDes($A$2:$B$2, "165120018")
```
2行目をヘッダーとして使用し、先物OP銘柄情報を表示します。

### 海外先物の銘柄情報
```excel
=RssFOPMarketDes(, "N225.202106.C")  // CME 225先物
=RssFOPMarketDes(, "N225.202106.S")  // SGX 225先物
```

### 制限値幅のみ取得
A2セルに「制限値幅上限」、B2セルに「制限値幅下限」のヘッダーがある場合：
```excel
=RssFOPMarketDes($A$2:$B$2, "165120018")
```

## 戻り値

### 成功時の出力形式

**データ構造**: 多列連続セル出力
- **関数セル**: 全項目が表示された場合のヘッダー行
- **第2行**: 先物OP銘柄情報データ

### 実際の出力例

#### 日経225先物の銘柄情報
```excel
=RssFOPMarketDes(, "165120018")
```

**出力結果**:
| 行 | 制限値幅上限 | 制限値幅下限 |
|-----|----------------|----------------|
| 1(関数) | 制限値幅上限 | 制限値幅下限 |
| 2 | 30500 | 25500 |

#### 日経225ミニ先物の銘柄情報
```excel
=RssFOPMarketDes(, "163120015")
```

**出力結果**:
| 行 | 制限値幅上限 | 制限値幅下限 |
|-----|----------------|----------------|
| 1(関数) | 制限値幅上限 | 制限値幅下限 |
| 2 | 30500 | 25500 |

#### CME日経225先物の銘柄情報
```excel
=RssFOPMarketDes(, "N225.202406.C")
```

**出力結果**:
| 行 | 制限値幅上限 | 制限値幅下限 |
|-----|----------------|----------------|
| 1(関数) | 制限値幅上限 | 制限値幅下限 |
| 2 | 31000 | 25000 |

#### オプション銘柄の例
```excel
=RssFOPMarketDes(, "145234567")  // 日経225コールオプション
```

**出力結果**:
| 行 | 制限値幅上限 | 制限値幅下限 |
|-----|----------------|----------------|
| 1(関数) | 制限値幅上限 | 制限値幅下限 |
| 2 | 5000 | 1 |

### 出力項目別の値範囲・形式

| 項目名 | データ型 | 値の範囲・形式 | 例 | 備考 |
|--------|----------|----------------|-----|------|
| 制限値幅上限 | number | 正数(価格) | `30500`, `31000`, `5000` | 円・ポイント単位、前日清算価格基準 |
| 制限値幅下限 | number | 正数(価格) | `25500`, `25000`, `1` | 円・ポイント単位、前日清算価格基準 |

### 商品別制限値幅範囲

| 商品タイプ | 制限値幅目安 | 上限例 | 下限例 | 特徴 |
|------------|-------------|-------|-------|------|
| 日経225先物 | ±2500円 | 30500円 | 25500円 | 最も流動性が高い |
| 日経225ミニ | ±2500円 | 30500円 | 25500円 | 先物と同一制限値幅 |
| TOPIX先物 | ±200pt | 2200pt | 1800pt | ポイント単位 |
| 金先物 | ±200円 | 8200円 | 7800円 | 貴金属商品 |
| プラチナ先物 | ±150円 | 3650円 | 3350円 | 金より値幅小さめ |
| 原油先物 | ±2000円 | 82000円 | 78000円 | 商品先物代表 |
| 日経225コールOP | 変動制 | 5000円 | 1円 | 権利行使価格に依存 |
| 日経225プットOP | 変動制 | 5000円 | 1円 | 権利行使価格に依存 |

### オプション特有の制限値幅

| オプション状態 | 制限値幅特徴 | 上限目安 | 下限 |
|----------------|-------------|----------|------|
| ITM(イン・ザ・マネー) | 内在価値反映 | 3000-8000円 | 1000円 |
| ATM(アット・ザ・マネー) | 時間価値中心 | 1000-3000円 | 100円 |
| OTM(アウト・オブ・ザ・マネー) | 低価格域 | 100-1000円 | 1円 |

### 失敗時の出力

**データ構造**: 単一セル
- **関数セル**: エラーコード（Excel標準エラー）

**可能なエラーコード**:
- `#VALUE!` - パラメータ形式エラー
- `#N/A` - 銘柄コード無効、データなし、限月期限切れ
- `#REF!` - セル参照エラー

### 特別なケース

#### 無効な銘柄コード
```excel
=RssFOPMarketDes(, "999999999")
```
結果：`#N/A`

#### 限月期限切れ
```excel
=RssFOPMarketDes(, "165120018")  // 期限切れした限月
```
結果：`#N/A`

#### ヘッダー行指定エラー
```excel
=RssFOPMarketDes($A$1:$E$1, "165120018")  // 5列指定だが出力は2列
```
結果：最初2列のみ表示、残りは空欄

#### 制限値幅拡大措置適用時
```excel
=RssFOPMarketDes(, "165120018")  // ストップ高後の拡大措置
```
**出力結果**:
| 制限値幅上限(通常) | 制限値幅上限(拡大後) | 制限値幅下限(通常) | 制限値幅下限(拡大後) |
|-------------------|--------------------|--------------------|---------------------|
| 30500円 | 32000円 | 25500円 | 24000円 |

#### 新規上場初日
```excel
=RssFOPMarketDes(, "165999999")  // 新規上場初日の先物
```
**出力結果**:
| 制限値幅上限 | 制限値幅下限 |
|----------------|----------------|
| - | - |
※ 制限値幅なしまたは特別設定

#### SQ算出日の特別制限値幅
```excel
=RssFOPMarketDes(, "165120018")  // SQ算出日
```
**出力結果**: SQ算出に向けて調整された特別制限値幅
| 制限値幅上限 | 制限値幅下限 |
|----------------|----------------|
| 29000 | 27000 |

#### 海外先物の例外ケース
```excel
=RssFOPMarketDes(, "N225.202413.C")  // 存在しない限月
```
結果：`#N/A`

#### オプション最終取引日
```excel
=RssFOPMarketDes(, "145234567")  // オプション最終取引日
```
**出力結果**: 権利行使に向けた特別制限値幅
| 制限値幅上限 | 制限値幅下限 |
|----------------|----------------|
| 2000 | 0 |

#### 流動性の低い商品
```excel
=RssFOPMarketDes(, "175620045")  // ゴム先物等
```
**出力結果**: 流動性を考慮した広い制限値幅
| 制限値幅上限 | 制限値幅下限 |
|----------------|----------------|
| 320 | 180 |

## エラーコード
| エラー | 原因 | 対処法 |
|--------|------|--------|
| #VALUE! | パラメータ形式エラー | 銘柄コードの形式を確認 |
| #N/A | 銘柄コード無効、データなし | 銘柄コードを確認 |
| #REF! | セル参照エラー | ヘッダー行の指定を確認 |

## 関連関数
- **RssFOPMarket**: 先物OP市況情報
- **RssFOPCode**: 先物OPコード検索（銘柄コード取得に使用）
- **RssMarketHeader**: 市況情報ヘッダー行作成（商品種類=2）
- **RssFutInfo**: 先物取引情報（証拠金情報）

## 注意事項

1. **銘柄コード**: RssFOPCode関数で事前に銘柄コードを取得することを推奨
2. **制限値幅の変動**: 市況により制限値幅が拡大される場合があります
3. **限月管理**: 先物は限月があるため、期限切れに注意
4. **市場別情報**: 国内・海外で制限値幅の設定が異なります
5. **更新タイミング**: 制限値幅は毎営業日の取引開始前に更新

## 実用的な活用例

### 注文前の制限値幅確認
```excel
// 1. 銘柄コード取得
=RssFOPCode("N225F", "202106")
// 結果例: 165120018

// 2. 制限値幅確認
=RssFOPMarketDes(, "165120018")
```

### 注文価格の妥当性チェック
```excel
// A2: 注文価格
// B2: =RssFOPMarketDes(上限セル, "165120018") // 制限値幅上限
// C2: =RssFOPMarketDes(下限セル, "165120018") // 制限値幅下限
// D2: =IF(AND(A2<=B2, A2>=C2), "OK", "制限値幅外")
```

### 複数限月の制限値幅比較
```excel
// 期近限月
=RssFOPCode("N225F", "202103")
=RssFOPMarketDes(, 上記結果)

// 期先限月  
=RssFOPCode("N225F", "202106")
=RssFOPMarketDes(, 上記結果)
```

## 制限値幅拡大措置

### 拡大条件
1. **ストップ高/安**: 制限値幅に張り付いた場合
2. **特別気配**: 大量の注文不均衡
3. **市況急変**: 重要な経済指標発表時等

### 拡大パターン
- **段階的拡大**: 通常の1.5倍、2倍と段階的に拡大
- **一時的拡大**: 当日限りの拡大措置
- **継続拡大**: 数日間継続する場合もあり

## 先物OP特有の考慮事項

### 限月の影響
- **期近限月**: 流動性が高く、制限値幅への到達頻度も高い
- **期先限月**: 流動性が低く、制限値幅内での値動きが中心

### SQ日の特別扱い
- **SQ算出日**: 特別清算指数算出に向けて制限値幅が調整される場合
- **最終取引日**: 限月最終日の制限値幅は特別設定

## 出力データの形式

関数実行後、以下の形式でデータが表示されます：

```
Row 1: =RssFOPMarketDes(, "165120018") (関数)
Row 2: [ヘッダー行] 制限値幅上限 | 制限値幅下限
Row 3: [データ]     30500       | 25500
```

## リスク管理での活用

### 最大損失の把握
```excel
// 現在値と制限値幅下限の差額 = 最大含み損
=RssFOPMarket("165120018", "現在値") - RssFOPMarketDes(下限セル, "165120018")
```

### ストップロス設定
```excel  
// 制限値幅を考慮したストップロス価格設定
// ストップロス = 現在値 - (制限値幅 × リスク許容度)
```

### ポジションサイジング
```excel
// 制限値幅リスクを考慮したポジションサイズ
// 許容損失額 ÷ 制限値幅 = 最大ポジション
```

## データ更新とタイミング

| 項目 | 更新タイミング | 更新頻度 |
|------|----------------|----------|
| 制限値幅上限 | 毎営業日朝 | 日次 |
| 制限値幅下限 | 毎営業日朝 | 日次 |
| 拡大措置 | リアルタイム | 随時 |

## バージョン情報
- RSS Version: 2.0
- 対応: Excel 2016以降
- 最終更新: 2024年

## 参考資料
- MARKETSPEED II RSS オンラインヘルプ
- MARKETSPEED II オンラインヘルプ「先物OP銘柄情報」
- 大阪取引所 先物・オプション取引制度