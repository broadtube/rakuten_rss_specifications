# RssFOPPositionList 非公式テスト確認仕様

## 概要
**関数名**: RssFOPPositionList  
**カテゴリ**: 先物OP建玉管理 (Futures & Options Position Management)  
**用途**: 先物OP建玉一覧の取得  

**説明**: 現在保有している先物・オプション建玉の一覧をExcelに表示します。建玉数量、評価損益、必要証拠金等の情報を取得でき、先物・オプション取引のリスク管理に活用できます。

## 構文 (Syntax)

### Excel ワークシート関数
```excel
RssFOPPositionList(ヘッダー行, 銘柄種類, 売買)
```

### VBA関数
```vb
RssFOPPositionList_V(ヘッダー行, 銘柄種類, 売買)
```

## パラメータ詳細

| No | パラメータ名 | 必要性 | データ型 | 説明 |
|----|------------|--------|----------|------|
| 1 | ヘッダー行 | △ | セル参照 | 取得項目が入力されているセル範囲を指定します<br>省略時はすべての取得項目を表示します |
| 2 | 銘柄種類 | △ | 文字列/数値 | 0:全て、F:指数先物全て、C:商品先物全て、N225F:日経225先物、N225MF:日経225ミニ、MOTF:東証マザーズ指数先物、N225OP:日経225オプション、N225C:日経225オプション コール、N225P:日経225オプション プット、GOLDF:金、GOLDMINIF:金ミニ、GOLDSPOTF:金スポット、PLATINUMF:白金、PLATINUMMINIF:白金ミニ、PLATINUMSPOTF:白金スポット、SILVERF:銀、PALLADIUMF:パラジウム、RSS3F:ゴム(RSS3)、TSR20F:ゴム(TSR20)、REDBEANF:小豆、SOYBEANF:一般大豆、CORNF:とうもろこし<br>省略時は「0」として扱います |
| 3 | 売買 | △ | 数値 | 0:全て、1:買、2:売<br>省略時は「0」として扱います |

**凡例**: ● 必須, △ 省略可, ▲ 条件次第で省略可, - 指定不要

## 使用例

### 基本的な先物OP建玉一覧取得（全て表示）
```excel
=RssFOPPositionList()
```
全ての先物OP建玉を表示（全パラメータ省略）

### ヘッダー行指定での取得
```excel
=RssFOPPositionList(A1:G1)
```
A1:G1セルにヘッダー項目を設定して、必要な項目のみを取得

### 日経225先物の建玉のみ取得
```excel
=RssFOPPositionList(, "N225F")
```
日経225先物の全建玉を表示

### 買建玉のみ取得
```excel
=RssFOPPositionList(, 0, 1)
```
全銘柄の買建玉のみを表示

### 複合条件での取得
```excel
=RssFOPPositionList(A1:G1, "N225F", 1)
```
日経225先物の買建玉のみを表示

## 戻り値

### 成功時の出力形式

**データ構造**: 一覧形式
- **ヘッダー行**: 項目名（省略時は自動生成）
- **データ行**: 各建玉の詳細情報

### 出力項目

| No | 項目名 | データ型 | 説明 |
|----|--------|----------|------|
| 1 | 銘柄コード | string | 証券コード協議会で定められた銘柄コードを表示 |
| 2 | 銘柄名称 | string | 銘柄名称を表示 |
| 3 | 売買 | string | 売買区分を表示（買、売） |
| 4 | 建玉数量 | number | 建玉数量を表示 |
| 5 | 建玉単価 | number | 平均建玉単価を表示 |
| 6 | 現在値 | number | 現在値を表示 |
| 7 | 評価損益 | number | 評価損益を表示 |
| 8 | 評価損益率 | number | 評価損益率を表示（%） |
| 9 | 建玉日 | string | 建玉日を表示 |
| 10 | 決済期日 | string | 決済期日を表示 |
| 11 | 必要証拠金 | number | 必要証拠金を表示 |
| 12 | 維持証拠金 | number | 維持証拠金を表示 |

### 実際の出力例

#### 全建玉の一覧
```excel
=RssFOPPositionList()
```
結果：
```
銘柄コード    銘柄名称          売買    建玉数量    建玉単価    現在値    評価損益    評価損益率    建玉日        決済期日
N225F        日経225先物3月限  買      1          38450      38600    150000     0.39         2024/12/01    2025/03/14
N225OP2412C38000  日経225OP  売      5          150        120      15000      20.00        2024/12/01    2024/12/13
GOLDF        金先物2月限      買      1          8500       8550     50000      0.59         2024/12/01    2025/02/28
```

#### 日経225先物の建玉のみ
```excel
=RssFOPPositionList(, "N225F")
```
結果：
```
銘柄コード    銘柄名称          売買    建玉数量    建玉単価    現在値    評価損益    評価損益率    建玉日        決済期日
N225F        日経225先物3月限  買      1          38450      38600    150000     0.39         2024/12/01    2025/03/14
```

### 失敗時の出力

**可能なエラー**:
- `ヘッダー行に有効な項目名が存在しません。` - ヘッダー行に正しい項目名がない
- `ヘッダー行は、単一行のセル範囲で入力してください。` - ヘッダー行形式エラー
- `#VALUE!` - パラメータ形式エラー
- `#N/A` - ログインエラー、先物OP口座未開設

## エラーコード
| エラー | 原因 | 対処法 |
|--------|------|--------|
| ヘッダー行に有効な項目名が存在しません | ヘッダー行に正しい項目名がない | 正しい項目名を指定 |
| ヘッダー行は、単一行のセル範囲で入力してください | ヘッダー行形式エラー | 単一行のセル範囲を指定 |
| #VALUE! | パラメータ形式エラー | パラメータの型と値を確認 |
| #N/A | ログインエラー、先物OP口座未開設 | ログイン状況、口座開設状況を確認 |

## 活用例

### 建玉リスク管理
```excel
// A1に関数を配置
=RssFOPPositionList()

// 評価損益の合計を計算
=SUMIF(G:G,">0",G:G)  // 評価益の合計
=SUMIF(G:G,"<0",G:G)  // 評価損の合計
```

### 銘柄別建玉管理
```excel
// 日経225先物の建玉のみ
=RssFOPPositionList(, "N225F")

// 日経225オプションの建玉のみ
=RssFOPPositionList(, "N225OP")
```

### VBAでの活用
```vb
Sub CheckFOPPositions()
    Dim posData As Variant
    
    ' 全建玉を取得
    posData = Application.WorksheetFunction.RssFOPPositionList_V()
    
    ' 評価損益の合計を計算
    Dim totalPnL As Double
    Dim i As Long
    For i = 2 To UBound(posData, 1)
        totalPnL = totalPnL + posData(i, 7)  ' 評価損益列
    Next i
    
    MsgBox "評価損益合計: " & Format(totalPnL, "#,##0") & "円"
End Sub
```

## 関連関数
- **RssFOPOrderList**: 先物OP注文一覧
- **RssFOPExecutionList**: 先物OP約定一覧
- **RssFOPOpenOrder**: 先物OP新規注文
- **RssFOPCloseOrder**: 先物OP決済注文
- **RssFOPCapacityList**: 先物OP余力情報

## 注意事項

1. **自動更新なし**: この関数は自動更新対象外です（-）
2. **ログイン必要**: 楽天証券へのログインが必要です
3. **先物OP口座必要**: 先物・オプション取引口座の開設が必要です
4. **建玉データのリアルタイム性**: 建玉情報は市場の状態により随時変化します
5. **銘柄種類の指定**: 銘柄種類は文字列または数値で指定可能です
6. **売買の区別**: 1:買（買建玉）、2:売（売建玉）を指定できます
7. **項目名の正確性**: ヘッダー行を指定する場合は項目名を正確に入力する必要があります

## パラメータの説明

### 銘柄種類
- 指数先物、商品先物、オプションなど多様な銘柄種類を指定可能
- 文字列コード（N225F等）または数値（0）で指定

### 売買
- 0: 全て（デフォルト）
- 1: 買（買建玉のみ表示）
- 2: 売（売建玉のみ表示）

## バージョン情報
- RSS Version: 2.0
- 対応: Excel 2016以降
- 最終更新: 2024年

## 参考資料
- MARKETSPEED II RSS オンラインヘルプ
- 楽天証券 RSS関数マニュアル PDF