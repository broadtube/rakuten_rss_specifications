# RssFOPExecutionList 非公式テスト確認仕様

## 概要
**関数名**: RssFOPExecutionList  
**カテゴリ**: 先物OP約定管理 (Futures & Options Execution Management)  
**用途**: 先物OP約定一覧の取得  

**説明**: 先物・オプション取引の約定一覧を取得してExcelに表示します。約定済みの取引の詳細情報（約定価格、約定数量、約定日時等）を確認でき、先物・オプション取引の履歴管理や損益計算に活用できます。

## 構文 (Syntax)

### Excel ワークシート関数
```excel
RssFOPExecutionList(ヘッダー行, 銘柄種類, 取引種類)
```

### VBA関数
```vb
RssFOPExecutionList_V(ヘッダー行, 銘柄種類, 取引種類)
```

## パラメータ詳細

| No | パラメータ名 | 必要性 | データ型 | 説明 |
|----|------------|--------|----------|------|
| 1 | ヘッダー行 | △ | セル参照 | 取得項目が入力されているセル範囲を指定します<br>省略時はすべての取得項目を表示します |
| 2 | 銘柄種類 | △ | 文字列/数値 | 0:全て、F:指数先物全て、C:商品先物全て、N225F:日経225先物、N225MF:日経225ミニ、MOTF:東証マザーズ指数先物、N225OP:日経225オプション、N225C:日経225オプション コール、N225P:日経225オプション プット、GOLDF:金、GOLDMINIF:金ミニ、GOLDSPOTF:金スポット、PLATINUMF:白金、PLATINUMMINIF:白金ミニ、PLATINUMSPOTF:白金スポット、SILVERF:銀、PALLADIUMF:パラジウム、RSS3F:ゴム(RSS3)、TSR20F:ゴム(TSR20)、REDBEANF:小豆、SOYBEANF:一般大豆、CORNF:とうもろこし<br>省略時は「0」として扱います |
| 3 | 取引種類 | △ | 数値 | 0:全て、1:売建、2:転売、3:買建、4:買戻、5:ＳＱ決済<br>省略時は「0」として扱います |

**凡例**: ● 必須, △ 省略可, ▲ 条件次第で省略可, - 指定不要

## 使用例

### 基本的な先物OP約定一覧取得（全て表示）
```excel
=RssFOPExecutionList()
```
全ての先物OP約定を表示（全パラメータ省略）

### ヘッダー行指定での取得
```excel
=RssFOPExecutionList(A1:G1)
```
A1:G1セルにヘッダー項目を設定して、必要な項目のみを取得

### 日経225先物の約定のみ取得
```excel
=RssFOPExecutionList(, "N225F")
```
日経225先物の全約定を表示

### 買建取引の約定のみ取得
```excel
=RssFOPExecutionList(, 0, 3)
```
全銘柄の買建約定のみを表示

### 複合条件での取得
```excel
=RssFOPExecutionList(A1:G1, "N225F", 3)
```
日経225先物の買建約定のみを表示

## 戻り値

### 成功時の出力形式

**データ構造**: 一覧形式
- **ヘッダー行**: 項目名（省略時は自動生成）
- **データ行**: 各約定の詳細情報

### 出力項目

| No | 項目名 | データ型 | 説明 |
|----|--------|----------|------|
| 1 | 約定日 | string | 約定日を表示（YYYY/MM/DD HH:MM:SS） |
| 2 | 銘柄コード | string | 証券コード協議会で定められた銘柄コードを表示 |
| 3 | 銘柄名称 | string | 銘柄名称を表示 |
| 4 | 市場名称 | string | 市場を表示 |
| 5 | セッション区分 | string | セッション区分を表示（日中、夜間） |
| 6 | 取引 | string | 取引内容を表示（売建、転売、買建、買戻、ＳＱ決済） |
| 7 | 約定数量 | number | 約定数量を表示 |
| 8 | 約定単価 | number | 約定単価を表示 |
| 9 | 約定金額 | number | 約定金額を表示 |
| 10 | 手数料 | number | 手数料を表示 |
| 11 | 手数料消費税 | number | 手数料の消費税を表示 |
| 12 | 受渡日 | string | 受渡日を表示 |
| 13 | 注文番号 | string | 注文番号を表示 |

### 実際の出力例

#### 全約定の一覧
```excel
=RssFOPExecutionList()
```
結果：
```
約定日                銘柄コード    銘柄名称          市場名称    セッション区分    取引    約定数量    約定単価    約定金額
2024/12/01 09:01:15  N225F        日経225先物3月限  大阪        日中            買建    1          38450      38450000
2024/12/01 10:30:45  N225OP2412C38000  日経225OP   大阪        日中            売建    5          150        750000
2024/12/01 14:15:32  GOLDF        金先物2月限      大阪        日中            買建    1          8500       8500000
```

#### 日経225先物の約定のみ
```excel
=RssFOPExecutionList(, "N225F")
```
結果：
```
約定日                銘柄コード    銘柄名称          市場名称    セッション区分    取引    約定数量    約定単価    約定金額
2024/12/01 09:01:15  N225F        日経225先物3月限  大阪        日中            買建    1          38450      38450000
```

### 失敗時の出力

**可能なエラー**:
- `ヘッダー行に有効な項目名が存在しません。` - ヘッダー行に正しい項目名がない
- `ヘッダー行は、単一行のセル範囲で入力してください。` - ヘッダー行形式エラー
- `#VALUE!` - パラメータ形式エラー
- `#N/A` - ログインエラー、先物OP口座未開設

## エラーコード
| エラー | 原因 | 対処法 |
|--------|------|--------|
| ヘッダー行に有効な項目名が存在しません | ヘッダー行に正しい項目名がない | 正しい項目名を指定 |
| ヘッダー行は、単一行のセル範囲で入力してください | ヘッダー行形式エラー | 単一行のセル範囲を指定 |
| #VALUE! | パラメータ形式エラー | パラメータの型と値を確認 |
| #N/A | ログインエラー、先物OP口座未開設 | ログイン状況、口座開設状況を確認 |

## 活用例

### 約定履歴の分析
```excel
// A1に関数を配置
=RssFOPExecutionList()

// 本日の約定数をカウント
=COUNTIF(A:A,TODAY())
```

### 銘柄別約定管理
```excel
// 日経225先物の約定のみ
=RssFOPExecutionList(, "N225F")

// 日経225オプションの約定のみ
=RssFOPExecutionList(, "N225OP")
```

### VBAでの活用
```vb
Sub CheckFOPExecutions()
    Dim execData As Variant
    
    ' 全約定を取得
    execData = Application.WorksheetFunction.RssFOPExecutionList_V()
    
    ' 約定金額の合計を計算
    Dim totalAmount As Double
    Dim i As Long
    For i = 2 To UBound(execData, 1)
        totalAmount = totalAmount + execData(i, 9)  ' 約定金額列
    Next i
    
    MsgBox "約定金額合計: " & Format(totalAmount, "#,##0") & "円"
End Sub
```

## 関連関数
- **RssFOPOrderList**: 先物OP注文一覧
- **RssFOPPositionList**: 先物OP建玉一覧
- **RssFOPCapacityList**: 先物OP余力情報
- **RssFOPOpenOrder**: 先物OP新規注文
- **RssFOPCloseOrder**: 先物OP決済注文

## 注意事項

1. **自動更新なし**: この関数は自動更新対象外です（-）
2. **ログイン必要**: 楽天証券へのログインが必要です
3. **先物OP口座必要**: 先物・オプション取引口座の開設が必要です
4. **約定データの保存期間**: 約定データは一定期間のみ保存されます
5. **銘柄種類の指定**: 銘柄種類は文字列または数値で指定可能です
6. **取引種類の区別**: 売建・買建は新規、転売・買戻は決済を意味します
7. **項目名の正確性**: ヘッダー行を指定する場合は項目名を正確に入力する必要があります

## パラメータの説明

### 銘柄種類
- 指数先物、商品先物、オプションなど多様な銘柄種類を指定可能
- 文字列コード（N225F等）または数値（0）で指定

### 取引種類
- 1: 売建（新規売りポジション）
- 2: 転売（買いポジションの決済）
- 3: 買建（新規買いポジション）
- 4: 買戻（売りポジションの決済）
- 5: ＳＱ決済（特別清算による決済）

## バージョン情報
- RSS Version: 2.0
- 対応: Excel 2016以降
- 最終更新: 2024年

## 参考資料
- MARKETSPEED II RSS オンラインヘルプ
- 楽天証券 RSS関数マニュアル PDF