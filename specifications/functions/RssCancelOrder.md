# RssCancelOrder 完全仕様書

## 概要
**関数名**: RssCancelOrder  
**カテゴリ**: 注文管理 (Order Management)  
**用途**: 注文取消の実行  

**説明**: 注文番号を指定して既存注文の取消を行います。未約定の注文のみ取消可能で、約定済み・部分約定済みの注文は取消できません。

## 構文 (Syntax)

### Excel ワークシート関数
```excel
RssCancelOrder(発注ID, 発注トリガー, 注文番号)
```

### VBA関数
```vb
RssCancelOrder_V(発注ID, 注文番号)
```

## パラメータ詳細

| No | パラメータ名 | データ型 | 必須/任意 | 説明 |
|----|------------|----------|-----------|------|
| 1 | 発注ID | number | ● | Excelから注文を一意に識別するための番号<br>(1以上2147483647以下の数値で入力) |
| 2 | 発注トリガー | number | ● | 1(True):発注, 0(False):待機<br>（Excel版のみ、VBA版では不要） |
| 3 | 注文番号 | number | ● | 取消対象明細の注文番号を入力 |

**凡例**: ● 必須

## 使用例

### 基本的な注文取消
```excel
=RssCancelOrder(8,1,123457)
```
注文番号123457の注文を取消

### 複数注文の取消
```excel
=RssCancelOrder(9,1,123458)
=RssCancelOrder(10,1,123459)
=RssCancelOrder(11,1,123460)
```
注文番号123458、123459、123460の注文をそれぞれ取消

### VBA版での取消
```vb
RssCancelOrder_V(12, 123461)
```
VBA版では発注トリガーパラメータが不要

## 戻り値

### 成功時の出力形式

**データ構造**: 単一セル
- **関数セル**: 取消受付番号（文字列）

### 実際の出力例

#### 成功時の取消受付番号
```excel
=RssCancelOrder(8,1,123457)
```
結果：`C2024050800001` （文字列、取消受付番号）

#### 現物注文の取消
```excel
=RssCancelOrder(9,1,567890)  // 現物注文
```
結果：`C2024050800002` （文字列、取消受付番号）

#### 信用注文の取消
```excel
=RssCancelOrder(10,1,234567)  // 信用注文
```
結果：`C2024050800003` （文字列、取消受付番号）

### 取消受付番号の形式

| 項目 | 形式 | 例 | 説明 |
|------|------|-----|------|
| 受付番号 | string | `C` + `YYYYMMDD` + 5桁連番 | `C2024050800001` |
| プレフィックス | string | `C` | 取消取引識別コード |
| 日付部分 | string | `YYYYMMDD` | 取消日（年月日） |
| 連番部分 | string | 5桁数字 | 日内連続番号 |

### 失敗時の出力

**データ構造**: 単一セル
- **関数セル**: エラーコード（Excel標準エラー）

**可能なエラーコード**:
- `#VALUE!` - パラメータ形式エラー、発注ID重複
- `#N/A` - 注文番号無効、取消不可状態、市場休場等
- `#NUM!` - 注文番号の範囲外
- `#REF!` - セル参照エラー

### 特別なケース

#### 無効な注文番号
```excel
=RssCancelOrder(8,1,999999)
```
結果：`#N/A`

#### 既に約定済み注文
```excel
=RssCancelOrder(8,1,123456)  // 約定済み注文
```
結果：`#N/A`

#### 既に取消済み注文
```excel
=RssCancelOrder(8,1,123456)  // 既に取消済み
```
結果：`#N/A`

#### 部分約定済み注文
```excel
=RssCancelOrder(8,1,123456)  // 一部約定済み注文
```
結果：`C2024050800001` （未約定分のみ取消、成功）

#### 市場休場時
```excel
=RssCancelOrder(8,1,123456)  // 土日祝日
```
結果：`#N/A`

#### 発注ID重複使用
```excel
=RssCancelOrder(8,1,123457)  // 既に使用済みのID
```
結果：`#VALUE!`

### 取消可能な注文状態

| 注文状態 | 取消可否 | 結果 |
|----------|----------|------|
| 未約定 | ○ | 全量取消 |
| 部分約定 | ○ | 未約定分のみ取消 |
| 全部約定 | × | `#N/A` |
| 既に取消済み | × | `#N/A` |
| 訂正中 | × | `#N/A` |

## エラーコード
| エラー | 原因 | 対処法 |
|--------|------|--------|
| #VALUE! | パラメータ形式エラー、発注ID重複 | パラメータの型と値、発注IDを確認 |
| #N/A | 注文番号無効、取消不可状態、市場休場等 | 注文番号、注文状況、市場時間を確認 |
| #NUM! | 注文番号の範囲外 | 正しい注文番号の形式を確認 |
| #REF! | セル参照エラー | セル参照の指定を確認 |

## 取消不可な注文の例

### 約定済み注文
- 全部約定した注文は取消できません
- 部分約定した注文は未約定分のみ取消可能

### 執行中の注文
- 寄付・引けで執行中の注文
- 条件付注文で条件成就中の注文

### システム処理中
- 他の訂正処理中の注文
- システム障害時の一時的な処理不可

## 関連関数
- **RssStockOrder**: 現物注文
- **RssMarginOpenOrder**: 信用新規注文  
- **RssModifyOrder**: 注文訂正
- **RssOrderList**: 注文一覧（注文番号確認用）
- **RssOrderStatus**: 注文状況確認

## 注意事項

1. **注文番号確認**: RssOrderList関数で事前に注文番号を確認してください
2. **取消タイミング**: 約定前に取消する必要があります
3. **市場時間**: 各市場の開場時間内で取消可能です
4. **発注ID管理**: 同一発注IDの重複使用はエラーになります
5. **部分約定**: 部分約定した注文は未約定分のみ取消されます

## 実用的な活用例

### 注文状況確認後の取消
```excel
// 1. 注文一覧で状況確認
=RssOrderList()

// 2. 未約定確認後に取消実行
=RssCancelOrder(8,1,123457)
```

### 複数注文の一括取消
```excel
// A列に発注ID、B列に注文番号を設定
=RssCancelOrder(A2,1,B2)
=RssCancelOrder(A3,1,B3)
=RssCancelOrder(A4,1,B4)
```

### 条件付き取消
```excel
// 特定時刻になったら取消実行
=IF(TIME(15,0,0)<NOW(), RssCancelOrder(8,1,123457), "待機中")
```

## 取消処理の流れ

1. **注文番号確認**: RssOrderListで取消対象を特定
2. **注文状況確認**: RssOrderStatusで取消可能か確認
3. **取消実行**: RssCancelOrderで取消処理
4. **結果確認**: 受付番号またはエラーで結果確認

## バージョン情報
- RSS Version: 2.0
- 対応: Excel 2016以降
- 最終更新: 2024年

## 参考資料
- MARKETSPEED II RSS オンラインヘルプ  
- 楽天証券 RSS関数マニュアル PDF